<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ˜Ÿåº§äººæ ¼å¯¦é©—ï½œå¿ƒç†æ¸¬é©—</title>
  <meta name="description" content="ä¸€å ´å¿ƒç†å­¸å¯¦é©—ï¼šä½ ç›¸ä¿¡æ˜Ÿåº§å—ï¼Ÿé€™å€‹ç¶²ç«™è®“ä½ é«”é©—ç‚ºä»€éº¼æˆ‘å€‘è¦ºå¾—æ˜Ÿåº§åˆ†æã€å¾ˆæº–ã€ã€‚">
  <meta name="keywords" content="æ˜Ÿåº§æ¸¬é©—,å¿ƒç†å­¸å¯¦é©—,æ˜Ÿåº§äººæ ¼,å¿ƒç†æ¸¬é©—,æ˜Ÿåº§åˆ†æ,æ˜Ÿåº§æ€§æ ¼,äººæ ¼æ¸¬è©¦">
  <meta name="author" content="æ˜Ÿåº§äººæ ¼å¯¦é©—">
  <meta name="robots" content="index, follow">
  
  <!-- Google Search Console Verification -->
  <meta name="google-site-verification" content="l-fEHYonQavlh9KlKoLMVreyAKSoukHloQ0_SkqrfY0" />
  
  <!-- Open Graph Tags -->
  <meta property="og:title" content="æ˜Ÿåº§äººæ ¼å¯¦é©—ï½œå¿ƒç†æ¸¬é©—">
  <meta property="og:description" content="ä¸€å ´å¿ƒç†å­¸å¯¦é©—ï¼šä½ ç›¸ä¿¡æ˜Ÿåº§å—ï¼Ÿé€™å€‹ç¶²ç«™è®“ä½ é«”é©—ç‚ºä»€éº¼æˆ‘å€‘è¦ºå¾—æ˜Ÿåº§åˆ†æã€å¾ˆæº–ã€ã€‚">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://your-username.github.io/zodiac-experiment/">
  <meta property="og:image" content="" id="dynamic-og-image">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="æ˜Ÿåº§äººæ ¼å¯¦é©—">
  <meta property="og:locale" content="zh_TW">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="æ˜Ÿåº§äººæ ¼å¯¦é©—ï½œå¿ƒç†æ¸¬é©—">
  <meta name="twitter:description" content="ä¸€å ´å¿ƒç†å­¸å¯¦é©—ï¼šä½ ç›¸ä¿¡æ˜Ÿåº§å—ï¼Ÿé€™å€‹ç¶²ç«™è®“ä½ é«”é©—ç‚ºä»€éº¼æˆ‘å€‘è¦ºå¾—æ˜Ÿåº§åˆ†æã€å¾ˆæº–ã€ã€‚">
  <meta name="twitter:image" content="" id="dynamic-twitter-image">
  <meta name="twitter:site" content="@zodiac_experiment">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "æ˜Ÿåº§äººæ ¼å¯¦é©—ï½œå¿ƒç†æ¸¬é©—",
    "description": "ä¸€å ´å¿ƒç†å­¸å¯¦é©—ï¼šä½ ç›¸ä¿¡æ˜Ÿåº§å—ï¼Ÿé€™å€‹ç¶²ç«™è®“ä½ é«”é©—ç‚ºä»€éº¼æˆ‘å€‘è¦ºå¾—æ˜Ÿåº§åˆ†æã€å¾ˆæº–ã€ã€‚",
    "applicationCategory": "PsychologyApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "TWD"
    },
    "author": {
      "@type": "Organization",
      "name": "æ˜Ÿåº§äººæ ¼å¯¦é©—"
    },
    "audience": {
      "@type": "PeopleAudience",
      "suggestedMinAge": 13,
      "suggestedMaxAge": 100
    }
  }
  </script>
  
  <!-- å¼•å…¥ Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  
  <style>
    :root {
      --primary: #6a5acd;
      --secondary: #9370db;
      --accent: #ba55d3;
      --light: #f0f4f8;
      --dark: #333;
      --success: #4caf50;
      --warning: #ff9800;
      --error: #e74c3c;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    /* å±å¹•é–±è®€å™¨å°ˆç”¨æ¨£å¼ */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* å„ªåŒ–æ˜Ÿç©ºèƒŒæ™¯ */
    .stars-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: linear-gradient(135deg, #0b0b2d 0%, #1a1a4a 50%, #2d1a4a 100%);
      overflow: hidden;
    }
    
    .background-star {
      position: absolute;
      background-color: white;
      border-radius: 50%;
      animation: twinkle var(--duration, 5s) infinite var(--delay, 0s);
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    
    /* æ˜Ÿåº§é€£ç·šæ•ˆæœ */
    .constellation {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }
    
    .constellation-line {
      position: absolute;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transform-origin: left center;
      animation: linePulse 8s infinite;
    }
    
    @keyframes linePulse {
      0%, 100% { opacity: 0.1; }
      50% { opacity: 0.5; }
    }
    
    /* æµæ˜Ÿæ•ˆæœ */
    .shooting-star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 10px 2px white;
      opacity: 0;
    }
    
    @keyframes shoot {
      0% {
        opacity: 1;
        transform: translateX(0) translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateX(500px) translateY(250px);
      }
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      padding: 40px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }
    
    .container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(to right, var(--primary), var(--accent));
    }
    
    h1, h2, h3 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 20px;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(to right, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .hidden {
      display: none;
    }
    
    .step {
      animation: fadeIn 0.8s ease;
    }
    
    .step p {
      text-align: center;
      margin-bottom: 20px;
      font-size: 18px;
      color: var(--dark);
    }
    
    .input-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 25px 0;
      flex-wrap: wrap;
    }
    
    label {
      display: flex;
      flex-direction: column;
      font-weight: 600;
      color: var(--dark);
      min-width: 120px;
    }
    
    input, select {
      padding: 12px 15px;
      border: 2px solid #e1e5eb;
      border-radius: 8px;
      font-size: 16px;
      margin-top: 5px;
      transition: all 0.3s;
      width: 100%;
    }
    
    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.2);
    }
    
    button {
      padding: 12px 25px;
      margin-top: 20px;
      cursor: pointer;
      display: block;
      margin-left: auto;
      margin-right: auto;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(106, 90, 205, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(106, 90, 205, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(45deg);
      transition: all 0.5s;
      opacity: 0;
    }
    
    button:hover::after {
      opacity: 1;
      transform: rotate(45deg) translate(10%, 10%);
    }
    
    .zodiac-display {
      text-align: center;
      padding: 30px;
      background: linear-gradient(135deg, rgba(240, 244, 248, 0.7) 0%, rgba(225, 229, 235, 0.7) 100%);
      border-radius: 10px;
      margin: 20px 0;
      position: relative;
      overflow: hidden;
    }
    
    .zodiac-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(106, 90, 205, 0.05) 50%, transparent 70%);
      animation: shimmer 3s infinite linear;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .quiz-item {
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(248, 249, 250, 0.7);
      border-radius: 8px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
      backdrop-filter: blur(5px);
    }
    
    .quiz-question {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--dark);
    }
    
    .quiz-options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    
    .quiz-option {
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid rgba(225, 229, 235, 0.7);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quiz-option:hover {
      border-color: var(--primary);
      background: rgba(240, 244, 255, 0.8);
      transform: translateX(5px);
    }
    
    .quiz-option.selected {
      border-color: var(--primary);
      background: rgba(230, 233, 255, 0.8);
    }
    
    #report p {
      margin: 15px 0;
      padding: 15px;
      background: rgba(248, 249, 250, 0.7);
      border-radius: 8px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
      backdrop-filter: blur(5px);
    }
    
    .fade-in {
      opacity: 1 !important;
      transform: translateY(0) !important;
    }
    
    .flash {
      animation: flash 1.5s ease infinite alternate;
    }
    
    .progress-bar {
      height: 6px;
      background: rgba(225, 229, 235, 0.7);
      border-radius: 3px;
      margin: 20px 0;
      overflow: hidden;
    }
    
    .progress {
      height: 100%;
      background: linear-gradient(to right, var(--primary), var(--accent));
      width: 0%;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    
    .progress::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 20px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
      animation: progressShine 1.5s infinite;
    }
    
    @keyframes progressShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(500%); }
    }
    
    .reveal-content {
      text-align: center;
      padding: 20px;
    }
    
    .reveal-content p {
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .rating-stars {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    
    .rating-star {
      font-size: 24px;
      color: #e1e5eb;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .rating-star.active {
      color: #ffc107;
      text-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
    }
    
    .accuracy-rating {
      text-align: center;
      margin: 30px 0;
      padding: 20px;
      background: rgba(248, 249, 250, 0.7);
      border-radius: 10px;
      backdrop-filter: blur(5px);
    }
    
    .rating-scale {
      display: flex;
      justify-content: space-between;
      max-width: 400px;
      margin: 15px auto;
    }
    
    .rating-label {
      font-size: 14px;
      color: #666;
    }

    .self-rating {
      text-align: center;
      margin: 30px 0;
      padding: 20px;
      background: rgba(248, 249, 250, 0.7);
      border-radius: 10px;
      backdrop-filter: blur(5px);
    }

    .self-rating-question {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 20px;
    }

    .self-rating-stars {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .self-rating-star {
      font-size: 28px;
      color: #e1e5eb;
      cursor: pointer;
      transition: all 0.3s;
      padding: 5px;
    }

    .self-rating-star.active {
      color: #ff6b6b;
      text-shadow: 0 0 15px rgba(255, 107, 107, 0.7);
      transform: scale(1.2);
    }

    .self-rating-labels {
      display: flex;
      justify-content: space-between;
      max-width: 450px;
      margin: 10px auto;
    }

    .self-rating-label {
      font-size: 12px;
      color: #666;
      text-align: center;
      flex: 1;
    }

    .progress-indicator {
      display: flex;
      justify-content: center;
      margin: 30px 0 20px 0;
      gap: 10px;
    }

    .progress-step {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #e1e5eb;
      transition: all 0.3s;
    }

    .progress-step.active {
      background: var(--primary);
      transform: scale(1.2);
    }

    .progress-step.completed {
      background: var(--success);
    }

    .hint-text {
      text-align: center;
      color: #666;
      font-size: 14px;
      margin: 15px 0;
      font-style: italic;
    }
    
    .analyzing-container {
      text-align: center;
      padding: 40px 20px;
    }
    
    .analyzing-text {
      font-size: 24px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 30px;
    }
    
    .analyzing-dots {
      display: inline-block;
      position: relative;
      width: 80px;
      height: 80px;
    }
    
    .analyzing-dots div {
      position: absolute;
      top: 33px;
      width: 13px;
      height: 13px;
      border-radius: 50%;
      background: var(--primary);
      animation-timing-function: cubic-bezier(0, 1, 1, 0);
    }
    
    .analyzing-dots div:nth-child(1) {
      left: 8px;
      animation: analyzing-dots1 0.6s infinite;
    }
    
    .analyzing-dots div:nth-child(2) {
      left: 8px;
      animation: analyzing-dots2 0.6s infinite;
    }
    
    .analyzing-dots div:nth-child(3) {
      left: 32px;
      animation: analyzing-dots2 0.6s infinite;
    }
    
    .analyzing-dots div:nth-child(4) {
      left: 56px;
      animation: analyzing-dots3 0.6s infinite;
    }
    
    .zodiac-icon {
      font-size: 60px;
      margin-bottom: 20px;
      animation: pulse 2s infinite;
    }
    
    .report-category {
      margin: 25px 0;
      padding: 20px;
      background: rgba(248, 249, 250, 0.7);
      border-radius: 10px;
      backdrop-filter: blur(5px);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
    }
    
    .category-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .category-divider {
      height: 1px;
      background: linear-gradient(to right, transparent, var(--primary), transparent);
      margin: 20px 0;
    }
    
    .error-message {
      color: var(--error);
      font-size: 14px;
      text-align: center;
      margin-top: 10px;
      display: none;
    }
    
    .success-message {
      color: var(--success);
      font-size: 14px;
      text-align: center;
      margin-top: 10px;
      display: none;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      display: none;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    .result-animation {
      animation: bounceIn 0.8s ease-out;
    }
    
    /* çµ±è¨ˆå€åŸŸæ¨£å¼ */
    .statistics-section {
      text-align: center;
      margin: 30px 0;
      padding: 25px;
      background: rgba(248, 249, 250, 0.8);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(106, 90, 205, 0.1);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }

    .stat-item {
      padding: 20px 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .stat-item:hover {
      transform: translateY(-5px);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      font-weight: 500;
    }

    .zodiac-comparison {
      margin-top: 30px;
      text-align: left;
    }

    .zodiac-comparison h4 {
      text-align: center;
      color: var(--primary);
      margin-bottom: 20px;
    }

    .zodiac-comparison-content {
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
    }

    .zodiac-stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 10px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
      transition: all 0.3s ease;
    }

    .zodiac-stat-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .zodiac-name {
      font-weight: 600;
      color: var(--dark);
      min-width: 80px;
    }

    .zodiac-data {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .zodiac-data .stat {
      font-size: 13px;
      color: #666;
      background: rgba(106, 90, 205, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    /* åˆ†äº«å€åŸŸæ¨£å¼ */
    .share-section {
      text-align: center;
      margin: 30px 0;
      padding: 20px;
      background: rgba(248, 249, 250, 0.7);
      border-radius: 10px;
      backdrop-filter: blur(5px);
    }
    
    .share-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 20px;
    }
    
    .share-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .share-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      color: white;
      min-width: 120px;
    }
    
    .share-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    
    .share-facebook {
      background: #3b5998;
    }
    
    .share-twitter {
      background: #1da1f2;
    }
    
    .share-line {
      background: #00c300;
    }
    
    .share-copy {
      background: var(--primary);
    }
    
    .share-icon {
      font-size: 18px;
    }
    
    .share-result {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      border-left: 4px solid var(--primary);
      text-align: left;
    }
    
    .share-result-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--primary);
    }
    
    .share-result-text {
      font-size: 14px;
      color: var(--dark);
      line-height: 1.5;
    }
    
    /* éŸ³æ•ˆæ§åˆ¶å€åŸŸ */
    .audio-controls {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 100;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .audio-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
    }
    
    .audio-btn:hover {
      transform: scale(1.1);
      background: var(--secondary);
    }
    
    .audio-btn.muted {
      background: #666;
    }
    
    .audio-slider {
      width: 100px;
      height: 5px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 5px;
      outline: none;
      -webkit-appearance: none;
    }
    
    .audio-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }
    
    /* çœŸç›¸æ­é–‹ç‰¹æ•ˆ */
    .truth-reveal-container {
      position: relative;
      overflow: hidden;
    }
    
    .truth-mask {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #6a5acd 0%, #9370db 50%, #ba55d3 100%);
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
    }
    
    .truth-text {
      font-size: 2.5rem;
      font-weight: bold;
      color: white;
      text-align: center;
      text-shadow: 0 0 20px rgba(255,255,255,0.8);
      animation: truthPulse 2s infinite;
    }
    
    @keyframes truthPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .crack {
      position: absolute;
      background: white;
      z-index: 11;
      opacity: 0;
    }
    
    .crack-horizontal {
      width: 100%;
      height: 3px;
      left: 0;
    }
    
    .crack-vertical {
      width: 3px;
      height: 100%;
      top: 0;
    }
    
    .crack-diagonal-1 {
      width: 3px;
      height: 140%;
      transform: rotate(45deg);
      top: -20%;
    }
    
    .crack-diagonal-2 {
      width: 3px;
      height: 140%;
      transform: rotate(-45deg);
      top: -20%;
    }
    
    .shard {
      position: absolute;
      background: white;
      border-radius: 50%;
      z-index: 11;
      opacity: 0;
    }
    
    .reveal-content.truth-revealed {
      animation: contentReveal 1.5s ease-out;
    }
    
    @keyframes contentReveal {
      0% { 
        opacity: 0;
        transform: scale(0.8) rotate(-5deg);
      }
      100% { 
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
    }
    
    .truth-explosion {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
    
    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      opacity: 0;
    }
    
    .glitch-text {
      position: relative;
      display: inline-block;
    }
    
    .glitch-text::before,
    .glitch-text::after {
      content: attr(data-text);
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .glitch-text::before {
      animation: glitch-1 0.5s infinite linear alternate-reverse;
      color: #ff00ff;
      z-index: -1;
    }
    
    .glitch-text::after {
      animation: glitch-2 0.5s infinite linear alternate-reverse;
      color: #00ffff;
      z-index: -2;
    }
    
    @keyframes glitch-1 {
      0% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, 2px); }
      80% { transform: translate(2px, -2px); }
      100% { transform: translate(0); }
    }
    
    @keyframes glitch-2 {
      0% { transform: translate(0); }
      20% { transform: translate(2px, 2px); }
      40% { transform: translate(2px, -2px); }
      60% { transform: translate(-2px, 2px); }
      80% { transform: translate(-2px, -2px); }
      100% { transform: translate(0); }
    }
    
    .matrix-rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
      opacity: 0;
    }
    
    .rain-char {
      position: absolute;
      color: #0f0;
      font-family: monospace;
      font-size: 14px;
      opacity: 0;
    }
    
    /* OG åœ–ç‰‡ç”Ÿæˆå™¨æ¨£å¼ */
    .og-generator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    
    .og-generator.active {
      display: flex;
    }
    
    .og-generator-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 90%;
      max-height: 90%;
      overflow: auto;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes flash {
      0% { color: var(--primary); }
      50% { color: var(--accent); }
      100% { color: var(--primary); }
    }
    
    @keyframes analyzing-dots1 {
      0% { transform: scale(0); }
      100% { transform: scale(1); }
    }
    
    @keyframes analyzing-dots3 {
      0% { transform: scale(1); }
      100% { transform: scale(0); }
    }
    
    @keyframes analyzing-dots2 {
      0% { transform: translate(0, 0); }
      100% { transform: translate(24px, 0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3);
      }
      50% {
        opacity: 1;
        transform: scale(1.05);
      }
      70% {
        transform: scale(0.9);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .input-group {
        flex-direction: column;
        align-items: center;
      }
      
      .rating-scale {
        flex-direction: column;
        gap: 10px;
      }

      .self-rating-stars {
        gap: 8px;
      }

      .self-rating-star {
        font-size: 24px;
      }

      .self-rating-labels {
        flex-direction: column;
        gap: 5px;
      }

      .progress-indicator {
        gap: 8px;
      }

      .progress-step {
        width: 10px;
        height: 10px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      
      .stat-value {
        font-size: 1.5rem;
      }
      
      .zodiac-stat-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .zodiac-data {
        width: 100%;
        justify-content: space-between;
      }
      
      .share-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .share-button {
        width: 100%;
        max-width: 200px;
      }
      
      .audio-controls {
        bottom: 10px;
        left: 10px;
      }
      
      .audio-slider {
        width: 80px;
      }
      
      .truth-text {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <!-- å„ªåŒ–æ˜Ÿç©ºèƒŒæ™¯ -->
  <div class="stars-background" id="stars-background" aria-hidden="true"></div>
  
  <!-- æ˜Ÿåº§é€£ç·š -->
  <div class="constellation" id="constellation" aria-hidden="true"></div>
  
  <!-- éŸ³æ•ˆæ§åˆ¶ -->
  <div class="audio-controls" aria-label="éŸ³æ•ˆæ§åˆ¶">
    <button class="audio-btn" id="audio-toggle" title="éŸ³æ•ˆé–‹é—œ" aria-label="éŸ³æ•ˆé–‹é—œ" aria-pressed="false">
      <span aria-hidden="true">â™ª</span>
    </button>
    <input type="range" min="0" max="100" value="50" class="audio-slider" id="audio-volume" 
           aria-label="éŸ³é‡å¤§å°" aria-valuemin="0" aria-valuemax="100" aria-valuenow="50">
  </div>
  
  <!-- åŠ è¼‰é®ç½©å±¤ -->
  <div class="loading-overlay" id="loading-overlay" aria-live="polite" aria-label="è¼‰å…¥ä¸­">
    <div class="loading-spinner" aria-hidden="true"></div>
    <span class="sr-only">é é¢è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</span>
  </div>
  
  <!-- ç²’å­çˆ†ç‚¸å®¹å™¨ -->
  <div class="truth-explosion" id="truth-explosion" aria-hidden="true"></div>
  
  <!-- çŸ©é™£é›¨å®¹å™¨ -->
  <div class="matrix-rain" id="matrix-rain" aria-hidden="true"></div>
  
  <!-- OG åœ–ç‰‡ç”Ÿæˆå™¨ -->
  <div class="og-generator" id="og-generator" role="dialog" aria-labelledby="og-title" aria-modal="true">
    <div class="og-generator-content">
      <h3 id="og-title">ç”Ÿæˆ OG é è¦½åœ–</h3>
      <canvas id="og-canvas" width="1200" height="630" style="border: 1px solid #ccc; max-width: 100%;" 
              aria-label="ç¤¾äº¤åª’é«”é è¦½åœ–ç‰‡"></canvas>
      <div style="margin-top: 20px; text-align: center;">
        <button onclick="downloadOGImage()" style="background: var(--success);" aria-label="ä¸‹è¼‰ç¤¾äº¤åª’é«”é è¦½åœ–ç‰‡">
          ä¸‹è¼‰ OG åœ–ç‰‡
        </button>
        <button onclick="closeOGGenerator()" style="background: var(--error);" aria-label="é—œé–‰å°è©±æ¡†">
          é—œé–‰
        </button>
      </div>
    </div>
  </div>

  <div class="container" role="main">
    <h1>æ˜Ÿåº§äººæ ¼å¯¦é©—</h1>
    
    <!-- ç®¡ç†å“¡å·¥å…·ï¼ˆåƒ…åœ¨é–‹ç™¼æ™‚é¡¯ç¤ºï¼‰ -->
    <div style="text-align: center; margin-bottom: 20px;">
      <button onclick="generateOGImage()" style="background: var(--warning); font-size: 14px; padding: 8px 16px;"
              aria-label="ç”Ÿæˆç¤¾äº¤åª’é«”é è¦½åœ–ç‰‡">
        ç”Ÿæˆ OG åœ–ç‰‡
      </button>
    </div>
    
    <!-- é€²åº¦æŒ‡ç¤ºå™¨ -->
    <nav class="progress-indicator" id="progress-indicator" aria-label="æ¸¬é©—é€²åº¦">
      <div class="progress-step active" id="step1-indicator" aria-current="step">
        <span class="sr-only">æ­¥é©Ÿ 1: è¼¸å…¥ç”Ÿæ—¥</span>
      </div>
      <div class="progress-step" id="step2-indicator">
        <span class="sr-only">æ­¥é©Ÿ 2: é¡¯ç¤ºæ˜Ÿåº§</span>
      </div>
      <div class="progress-step" id="step3-indicator">
        <span class="sr-only">æ­¥é©Ÿ 3: äººæ ¼æ¸¬é©—</span>
      </div>
      <div class="progress-step" id="step4-indicator">
        <span class="sr-only">æ­¥é©Ÿ 4: æŸ¥çœ‹å ±å‘Š</span>
      </div>
      <div class="progress-step" id="step5-indicator">
        <span class="sr-only">æ­¥é©Ÿ 5: çœŸç›¸æ­å¯†</span>
      </div>
      <div class="progress-step" id="step6-indicator">
        <span class="sr-only">æ­¥é©Ÿ 6: çµ±è¨ˆæ•¸æ“š</span>
      </div>
    </nav>
    
    <!-- æ­¥é©Ÿ1ï¼šè¼¸å…¥ç”Ÿæ—¥ -->
    <section id="step-birthday" class="step" aria-labelledby="step1-title">
      <h2 id="step1-title" class="sr-only">è¼¸å…¥ç”Ÿæ—¥è³‡è¨Š</h2>
      <p>è«‹è¼¸å…¥æ‚¨çš„ç”Ÿæ—¥ï¼Œæˆ‘å€‘å°‡ç‚ºæ‚¨åˆ†ææ˜Ÿåº§ç‰¹è³ªï¼š</p>
      <div class="input-group">
        <label for="birth-month">
          æœˆä»½ï¼š
          <select id="birth-month" aria-required="true" aria-describedby="birthday-hint">
            <option value="">è«‹é¸æ“‡</option>
            <option value="1">1æœˆ</option>
            <option value="2">2æœˆ</option>
            <option value="3">3æœˆ</option>
            <option value="4">4æœˆ</option>
            <option value="5">5æœˆ</option>
            <option value="6">6æœˆ</option>
            <option value="7">7æœˆ</option>
            <option value="8">8æœˆ</option>
            <option value="9">9æœˆ</option>
            <option value="10">10æœˆ</option>
            <option value="11">11æœˆ</option>
            <option value="12">12æœˆ</option>
          </select>
        </label>
        <label for="birth-day">
          æ—¥æœŸï¼š
          <select id="birth-day" aria-required="true" aria-describedby="birthday-hint">
            <option value="">è«‹é¸æ“‡</option>
          </select>
        </label>
      </div>
      <div id="birthday-hint" class="sr-only">è«‹é¸æ“‡æœˆä»½å’Œæ—¥æœŸä¾†ç¢ºå®šæ‚¨çš„æ˜Ÿåº§</div>
      <div class="error-message" id="birthday-error" role="alert" aria-live="polite"></div>
      <button onclick="submitBirthday()" aria-describedby="birthday-hint">
        ç¢ºèªæ˜Ÿåº§
      </button>
    </section>

    <!-- æ­¥é©Ÿ2ï¼šé¡¯ç¤ºæ˜Ÿåº§ -->
    <section id="step-zodiac" class="step hidden" aria-labelledby="step2-title">
      <h2 id="step2-title" class="sr-only">æ‚¨çš„æ˜Ÿåº§è³‡è¨Š</h2>
      <div class="zodiac-display" role="region" aria-labelledby="zodiac-name">
        <h2 id="zodiac-name"></h2>
        <p id="zodiac-dates"></p>
      </div>
      <button onclick="startQuiz()">
        é–‹å§‹äººæ ¼æ¸¬é©—
      </button>
    </section>

    <!-- æ­¥é©Ÿ3ï¼šæ¸¬é©— -->
    <section id="step-quiz" class="step hidden" aria-labelledby="step3-title">
      <h2 id="step3-title">å€‹äººç‰¹è³ªæ¸¬é©—</h2>
      <div class="progress-bar" aria-label="æ¸¬é©—é€²åº¦æ¢">
        <div class="progress" id="quiz-progress" role="progressbar" 
             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
          <span class="sr-only">æ¸¬é©—é€²åº¦: 0%</span>
        </div>
      </div>
      <form id="quiz-form" aria-label="äººæ ¼æ¸¬é©—å•å·"></form>
      <button id="quiz-submit" onclick="submitQuiz()" class="hidden" aria-label="å®Œæˆæ¸¬é©—">
        å®Œæˆæ¸¬é©—
      </button>
    </section>

    <!-- æ­¥é©Ÿ3.5ï¼šåˆ†æä¸­ -->
    <section id="step-analyzing" class="step hidden" aria-labelledby="analyzing-title">
      <h2 id="analyzing-title" class="sr-only">åˆ†æä¸­</h2>
      <div class="analyzing-container">
        <div class="zodiac-icon" id="analyzing-zodiac-icon" aria-hidden="true">â™‹</div>
        <div class="analyzing-text" aria-live="polite">
          åˆ†æä¸­<span id="analyzing-dots">...</span>
        </div>
        <div class="analyzing-dots" aria-hidden="true">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>
        <p style="margin-top: 30px; color: #666;">
          æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆå°ˆå±¬æ˜Ÿåº§äººæ ¼å ±å‘Š...
        </p>
      </div>
    </section>

    <!-- æ­¥é©Ÿ4ï¼šå ±å‘Š -->
    <section id="step-report" class="step hidden" aria-labelledby="step4-title">
      <h2 id="step4-title">æ‚¨çš„å°ˆå±¬æ˜Ÿåº§äººæ ¼å ±å‘Š</h2>
      <div id="report" role="region" aria-labelledby="step4-title"></div>
      
      <!-- é€™å°±æ˜¯æˆ‘è©•åˆ† -->
      <fieldset class="self-rating" aria-labelledby="self-rating-question">
        <legend id="self-rating-question" class="self-rating-question">
          ä»¥ä¸Šæè¿°åœ¨å¤šå¤§ç¨‹åº¦ä¸Šè®“ä½ è¦ºå¾—ã€é€™å°±æ˜¯æˆ‘ã€ï¼Ÿ
        </legend>
        <div class="self-rating-stars" id="self-rating-stars" role="radiogroup">
          <div class="self-rating-star" onclick="rateSelf(1)" role="radio" aria-checked="false" tabindex="0" 
               aria-label="1åˆ† - æœ€ä¸ç¬¦åˆ" onkeydown="handleStarKeydown(event, 1, 'self')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="self-rating-star" onclick="rateSelf(2)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="2åˆ†" onkeydown="handleStarKeydown(event, 2, 'self')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="self-rating-star" onclick="rateSelf(3)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="3åˆ†" onkeydown="handleStarKeydown(event, 3, 'self')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="self-rating-star" onclick="rateSelf(4)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="4åˆ†" onkeydown="handleStarKeydown(event, 4, 'self')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="self-rating-star" onclick="rateSelf(5)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="5åˆ† - æœ€ç¬¦åˆ" onkeydown="handleStarKeydown(event, 5, 'self')">
            <span aria-hidden="true">â˜…</span>
          </div>
        </div>
        <div class="self-rating-labels">
          <span class="self-rating-label">1åˆ†<br>æœ€ä¸ç¬¦åˆ</span>
          <span class="self-rating-label"></span>
          <span class="self-rating-label"></span>
          <span class="self-rating-label"></span>
          <span class="self-rating-label">5åˆ†<br>æœ€ç¬¦åˆ</span>
        </div>
      </fieldset>
      
      <!-- æ¸¬é©—æº–ç¢ºåº¦è©•åˆ† -->
      <fieldset class="accuracy-rating" aria-labelledby="accuracy-rating-question">
        <legend id="accuracy-rating-question">
          <h3>æ‚¨è¦ºå¾—é€™å€‹æ¸¬é©—çš„æº–ç¢ºåº¦å¦‚ä½•ï¼Ÿ</h3>
        </legend>
        <div class="rating-stars" id="accuracy-stars" role="radiogroup">
          <div class="rating-star" onclick="rateAccuracy(1)" role="radio" aria-checked="false" tabindex="0" 
               aria-label="1åˆ† - ä¸æº–" onkeydown="handleStarKeydown(event, 1, 'accuracy')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="rating-star" onclick="rateAccuracy(2)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="2åˆ†" onkeydown="handleStarKeydown(event, 2, 'accuracy')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="rating-star" onclick="rateAccuracy(3)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="3åˆ†" onkeydown="handleStarKeydown(event, 3, 'accuracy')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="rating-star" onclick="rateAccuracy(4)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="4åˆ†" onkeydown="handleStarKeydown(event, 4, 'accuracy')">
            <span aria-hidden="true">â˜…</span>
          </div>
          <div class="rating-star" onclick="rateAccuracy(5)" role="radio" aria-checked="false" tabindex="-1" 
               aria-label="5åˆ† - ç‹ æº–" onkeydown="handleStarKeydown(event, 5, 'accuracy')">
            <span aria-hidden="true">â˜…</span>
          </div>
        </div>
        <div class="rating-scale">
          <span class="rating-label">1åˆ† - ä¸æº–</span>
          <span class="rating-label">5åˆ† - ç‹ æº–</span>
        </div>
      </fieldset>

      <!-- éŒ¯èª¤æç¤º -->
      <div class="error-message" id="feedback-error" role="alert" aria-live="polite"></div>
      <div class="success-message" id="feedback-success" role="status" aria-live="polite"></div>
      
      <!-- æç¤ºæ–‡å­— -->
      <div class="hint-text">å®Œæˆè©•åˆ†å¾Œï¼Œè¨˜å¾—æŒ‰ä¸‹æ­å¯†æŒ‰éˆ•</div>
      
      <button onclick="submitFeedback()" aria-describedby="hint-text">
        æäº¤åé¥‹ä¸¦æ­å¯†
      </button>
    </section>

    <!-- æ­¥é©Ÿ5ï¼šæ­å¯†é  -->
    <section id="step-reveal" class="step hidden" aria-labelledby="step5-title">
      <h2 id="step5-title" class="sr-only">çœŸç›¸æ­å¯†</h2>
      <div class="truth-reveal-container">
        <!-- çœŸç›¸é®ç½©å±¤ -->
        <div class="truth-mask" id="truth-mask" aria-hidden="true">
          <div class="truth-text">çœŸç›¸å³å°‡æ­æ›‰...</div>
          <!-- è£‚ç—•æ•ˆæœ -->
          <div class="crack crack-horizontal" id="crack-1"></div>
          <div class="crack crack-vertical" id="crack-2"></div>
          <div class="crack crack-diagonal-1" id="crack-3"></div>
          <div class="crack crack-diagonal-2" id="crack-4"></div>
          <!-- ç¢ç‰‡ -->
          <div class="shard" id="shard-1"></div>
          <div class="shard" id="shard-2"></div>
          <div class="shard" id="shard-3"></div>
          <div class="shard" id="shard-4"></div>
        </div>
        
        <!-- åŸæœ‰å…§å®¹åŒ…è£åœ¨reveal-contentä¸­ -->
        <div class="reveal-content" id="reveal-content" style="opacity: 0;">
          <h2 class="glitch-text" data-text="æ­å¯†æ™‚é–“ï¼">æ­å¯†æ™‚é–“ï¼</h2>
          <p>å…¶å¯¦ï¼Œæ¯å€‹äººçœ‹åˆ°çš„å ±å‘Šçµæœéƒ½æ˜¯åŒä¸€ä»½é€šç”¨å ±å‘Š ğŸ˜‰</p>
          <p>é€™å€‹å¯¦é©—çš„ç›®çš„ï¼Œæ˜¯æƒ³è®“ä½ é«”é©—ä¸€å€‹æœ‰è¶£çš„å¿ƒç†å­¸ç¾è±¡ã€‚</p>
          <p>äººå€‘å¾€å¾€æœƒèªç‚ºä¸€äº›æ¨¡ç³Šã€æ™®éæ€§çš„äººæ ¼æè¿°éå¸¸æº–ç¢ºåœ°æ­ç¤ºäº†è‡ªå·±çš„ç‰¹é»ï¼Œ</p>
          <p>è€Œå¯¦éš›ä¸Šé€™äº›æè¿°é©ç”¨æ–¼å¾ˆå¤šäººã€‚</p>
          <p>æ„Ÿè¬æ‚¨åƒèˆ‡é€™å€‹å¿ƒç†å¯¦é©—ï¼</p>
          
          <button onclick="showStatistics()" style="margin: 20px 0;">
            æŸ¥çœ‹çœŸå¯¦çµ±è¨ˆæ•¸æ“š
          </button>
          <button onclick="restartExperiment()">
            é‡æ–°é–‹å§‹å¯¦é©—
          </button>
        </div>
      </div>
    </section>

    <!-- æ­¥é©Ÿ6ï¼šçµ±è¨ˆæ•¸æ“šé  -->
    <section id="step-statistics" class="step hidden" aria-labelledby="step6-title">
      <div class="reveal-content">
        <h2 id="step6-title">ğŸ“Š çœŸå¯¦å¯¦é©—æ•¸æ“šçµ±è¨ˆ</h2>
        <p>ä»¥ä¸‹æ˜¯æ‰€æœ‰åƒèˆ‡è€…çš„çœŸå¯¦è©•åˆ†æ•¸æ“šï¼ˆå¯¦æ™‚æ›´æ–°ï¼‰ï¼š</p>
        
        <!-- çµ±è¨ˆå€åŸŸ -->
        <div class="statistics-section" role="region" aria-labelledby="stats-title">
          <h3 id="stats-title">æ•´é«”çµ±è¨ˆ</h3>
          
          <div class="stats-grid">
            <div class="stat-item" role="status" aria-labelledby="total-participants-label">
              <div class="stat-value" id="total-participants">0</div>
              <div class="stat-label" id="total-participants-label">ç¸½åƒèˆ‡äººæ•¸</div>
            </div>
            
            <div class="stat-item" role="status" aria-labelledby="avg-self-rating-label">
              <div class="stat-value" id="avg-self-rating">0.00</div>
              <div class="stat-label" id="avg-self-rating-label">å¹³å‡ã€Œé€™å°±æ˜¯æˆ‘ã€è©•åˆ†</div>
            </div>
            
            <div class="stat-item" role="status" aria-labelledby="avg-accuracy-rating-label">
              <div class="stat-value" id="avg-accuracy-rating">0.00</div>
              <div class="stat-label" id="avg-accuracy-rating-label">å¹³å‡æº–ç¢ºåº¦è©•åˆ†</div>
            </div>
            
            <div class="stat-item" role="status" aria-labelledby="high-self-rating-percent-label">
              <div class="stat-value" id="high-self-rating-percent">0%</div>
              <div class="stat-label" id="high-self-rating-percent-label">é«˜èªåŒåº¦æ¯”ä¾‹ (4-5åˆ†)</div>
            </div>
          </div>
          
          <div class="zodiac-comparison" role="region" aria-labelledby="zodiac-comparison-title">
            <h4 id="zodiac-comparison-title">å„æ˜Ÿåº§èªåŒåº¦æ¯”è¼ƒ</h4>
            <div id="zodiac-comparison-content" class="zodiac-comparison-content" role="list" aria-label="å„æ˜Ÿåº§çµ±è¨ˆæ•¸æ“š">
              <!-- æ˜Ÿåº§æ•¸æ“šå°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
          </div>
        </div>

        <div class="category-divider" aria-hidden="true"></div>
        
        <!-- åˆ†äº«å€åŸŸ -->
        <div class="share-section" role="region" aria-labelledby="share-title">
          <div class="share-title" id="share-title">åˆ†äº«é€™å€‹æœ‰è¶£çš„å¯¦é©—çµ¦æœ‹å‹</div>
          <div class="share-buttons">
            <button class="share-button share-facebook" onclick="shareOnFacebook()" aria-label="åˆ†äº«åˆ° Facebook">
              <span class="share-icon" aria-hidden="true">f</span> Facebook
            </button>
            <button class="share-button share-twitter" onclick="shareOnTwitter()" aria-label="åˆ†äº«åˆ° Twitter">
              <span class="share-icon" aria-hidden="true">ğ•</span> Twitter
            </button>
            <button class="share-button share-line" onclick="shareOnLine()" aria-label="åˆ†äº«åˆ° LINE">
              <span class="share-icon" aria-hidden="true">LINE</span> LINE
            </button>
            <button class="share-button share-copy" onclick="copyShareLink()" aria-label="è¤‡è£½åˆ†äº«é€£çµ">
              <span class="share-icon" aria-hidden="true">ğŸ“‹</span> è¤‡è£½é€£çµ
            </button>
          </div>
          
          <div class="share-result">
            <div class="share-result-title">æˆ‘çš„å¯¦é©—çµæœï¼š</div>
            <div class="share-result-text" id="share-result-text">
              æˆ‘å‰›å‰›å®Œæˆäº†æ˜Ÿåº§äººæ ¼å¯¦é©—ï¼Œç™¼ç¾äº†ä¸€å€‹æœ‰è¶£çš„å¿ƒç†å­¸ç¾è±¡ï¼åŸä¾†æ¯å€‹äººçš„æ˜Ÿåº§å ±å‘Šéƒ½æ˜¯ä¸€æ¨£çš„ï¼Œä½†æˆ‘å€‘å»è¦ºå¾—å®ƒç‰¹åˆ¥æº–ç¢ºã€‚ä½ ä¹Ÿä¾†è©¦è©¦çœ‹å§ï¼
            </div>
          </div>
        </div>
        
        <button onclick="restartExperiment()" style="margin-top: 20px;">
          é‡æ–°é–‹å§‹å¯¦é©—
        </button>
      </div>
    </section>
  </div>

  <script>
    // Firebase é…ç½®
    const firebaseConfig = {
      apiKey: "AIzaSyCIn9yC8qBIrKNRvPkvCeNbSkkRLg3xqfU",
      authDomain: "zodiac-experiment.firebaseapp.com",
      projectId: "zodiac-experiment",
      storageBucket: "zodiac-experiment.firebasestorage.app",
      messagingSenderId: "932529210373",
      appId: "1:932529210373:web:56eba84e4b615bd382886c",
      measurementId: "G-JK860Q0MQH"
    };

    // æ˜Ÿåº§æ•¸æ“š
    const zodiacSigns = [
      { name: "æ‘©ç¾¯åº§", start: [12, 22], end: [1, 19], element: "åœŸ", symbol: "â™‘" },
      { name: "æ°´ç“¶åº§", start: [1, 20], end: [2, 18], element: "é¢¨", symbol: "â™’" },
      { name: "é›™é­šåº§", start: [2, 19], end: [3, 20], element: "æ°´", symbol: "â™“" },
      { name: "ç‰¡ç¾Šåº§", start: [3, 21], end: [4, 19], element: "ç«", symbol: "â™ˆ" },
      { name: "é‡‘ç‰›åº§", start: [4, 20], end: [5, 20], element: "åœŸ", symbol: "â™‰" },
      { name: "é›™å­åº§", start: [5, 21], end: [6, 20], element: "é¢¨", symbol: "â™Š" },
      { name: "å·¨èŸ¹åº§", start: [6, 21], end: [7, 22], element: "æ°´", symbol: "â™‹" },
      { name: "ç…å­åº§", start: [7, 23], end: [8, 22], element: "ç«", symbol: "â™Œ" },
      { name: "è™•å¥³åº§", start: [8, 23], end: [9, 22], element: "åœŸ", symbol: "â™" },
      { name: "å¤©ç§¤åº§", start: [9, 23], end: [10, 22], element: "é¢¨", symbol: "â™" },
      { name: "å¤©è åº§", start: [10, 23], end: [11, 21], element: "æ°´", symbol: "â™" },
      { name: "å°„æ‰‹åº§", start: [11, 22], end: [12, 21], element: "ç«", symbol: "â™" }
    ];

    // æ¸¬é©—é¡Œç›®å’Œé¸é …
    const quizQuestions = [
      "ç•¶é¢å°æ–°ç’°å¢ƒæ™‚ï¼Œä½ é€šå¸¸æœƒï¼š",
      "åœ¨ç¤¾äº¤å ´åˆä¸­ï¼Œä½ æ›´å‚¾å‘æ–¼ï¼š",
      "åšæ±ºç­–æ™‚ï¼Œä½ ä¸»è¦ä¾è³´ï¼š",
      "ä½ èªç‚ºè‡ªå·±æœ€å¤§çš„å„ªé»æ˜¯ï¼š",
      "é¢å°å£“åŠ›æ™‚ï¼Œä½ é€šå¸¸æœƒï¼š",
      "åœ¨åœ˜éšŠä¸­ï¼Œä½ é€šå¸¸æ‰®æ¼”çš„è§’è‰²æ˜¯ï¼š",
      "ä½ æ›´å–œæ­¡çš„å·¥ä½œæ–¹å¼æ˜¯ï¼š",
      "å°æ–¼æœªä¾†ï¼Œä½ çš„æ…‹åº¦æ˜¯ï¼š",
      "åœ¨æ„Ÿæƒ…é—œä¿‚ä¸­ï¼Œä½ é‡è¦–çš„æ˜¯ï¼š",
      "ä½ èªç‚ºæˆåŠŸçš„é—œéµæ˜¯ï¼š",
      "ç©ºé–’æ™‚é–“ï¼Œä½ æ›´é¡˜æ„ï¼š",
      "å°æ–¼æ‰¹è©•ï¼Œä½ çš„åæ‡‰é€šå¸¸æ˜¯ï¼š",
      "ä½ èªç‚ºè‡ªå·±æœ€éœ€è¦æ”¹é€²çš„æ˜¯ï¼š",
      "åœ¨å­¸ç¿’æ–°äº‹ç‰©æ™‚ï¼Œä½ å‚¾å‘æ–¼ï¼š",
      "ä½ çš„äººç”Ÿå“²å­¸æ›´æ¥è¿‘ï¼š"
    ];

    const quizOptions = [
      ["è¬¹æ…è§€å¯Ÿï¼Œæ…¢æ…¢é©æ‡‰", "ç©æ¥µæ¢ç´¢ï¼Œå¿«é€Ÿèå…¥", "éš¨é‡è€Œå®‰ï¼Œé †å…¶è‡ªç„¶", "æ„Ÿåˆ°ä¸å®‰ï¼Œéœ€è¦æ”¯æŒ"],
      ["ä¸»å‹•çµè­˜æ–°æœ‹å‹", "èˆ‡ç†Ÿæ‚‰çš„äººäº¤æµ", "è§€å¯Ÿä»–äººï¼Œé¸æ“‡æ€§äº¤æµ", "ç›¡é‡é¿å…ç¤¾äº¤äº’å‹•"],
      ["é‚è¼¯åˆ†æ", "ç›´è¦ºæ„Ÿå—", "ä»–äººæ„è¦‹", "éå¾€ç¶“é©—"],
      ["è²¬ä»»æ„Ÿå¼·", "å‰µé€ åŠ›è±å¯Œ", "å–„è§£äººæ„", "é©æ‡‰åŠ›å¼·"],
      ["åˆ¶å®šè¨ˆåŠƒè§£æ±ºå•é¡Œ", "å°‹æ±‚ä»–äººå¹«åŠ©", "æš«æ™‚é€ƒé¿æ”¾é¬†", "æƒ…ç·’åŒ–åæ‡‰"],
      ["é ˜å°è€…", "å”èª¿è€…", "åŸ·è¡Œè€…", "å‰µæ„æä¾›è€…"],
      ["ç¨ç«‹å®Œæˆ", "åœ˜éšŠåˆä½œ", "æœ‰æ˜ç¢ºæŒ‡å°", "è‡ªç”±ç™¼æ®"],
      ["å……æ»¿æœŸå¾…ï¼Œç©æ¥µè¦åŠƒ", "éš¨ç·£é¢å°ï¼Œä¸å¼·æ±‚", "æœ‰äº›æ“”æ†‚ï¼Œè¬¹æ…æº–å‚™", "äº«å—ç•¶ä¸‹ï¼Œä¸è€ƒæ…®å¤ªé "],
      ["ä¿¡ä»»èˆ‡å¿ èª ", "æºé€šèˆ‡ç†è§£", "æ¿€æƒ…èˆ‡æµªæ¼«", "ç¨ç«‹èˆ‡ç©ºé–“"],
      ["å …æŒèˆ‡åŠªåŠ›", "å‰µæ„èˆ‡éˆæ„Ÿ", "äººéš›é—œä¿‚", "æ©Ÿæœƒèˆ‡é‹æ°£"],
      ["ç¨è™•æ€è€ƒ", "èˆ‡æœ‹å‹ç›¸èš", "å˜—è©¦æ–°æ´»å‹•", "ä¼‘æ¯æ”¾é¬†"],
      ["èªçœŸåæ€", "è¾¯è§£æˆ–é˜²ç¦¦", "å°‹æ±‚è§£é‡‹", "æƒ…ç·’ä½è½"],
      ["éæ–¼å®Œç¾ä¸»ç¾©", "ç¼ºä¹è¡Œå‹•åŠ›", "éæ–¼æ•æ„Ÿ", "ä¸å–„è¡¨é”"],
      ["ç³»çµ±æ€§å­¸ç¿’", "å¯¦è¸ä¸­å­¸ç¿’", "å‘ä»–äººè«‹æ•™", "æ†‘èˆˆè¶£æ¢ç´¢"],
      ["æ´»åœ¨ç•¶ä¸‹", "è¦åŠƒæœªä¾†", "è¿½å°‹æ„ç¾©", "æœå‹™ä»–äºº"]
    ];

    // é€šç”¨å ±å‘Š
    const universalReport = {
      title: "æ‚¨çš„å°ˆå±¬æ˜Ÿåº§äººæ ¼ç‰¹è³ªå ±å‘Š",
      categories: [
        {
          title: "ğŸŒ™ å…§åœ¨æ€§æ ¼",
          items: [
            "1. ä½ æ˜¯ä¸€å€‹å…§å¿ƒç´°è†©ã€æ¸´æœ›è¢«ç†è§£çš„äººï¼Œé›–ç„¶å¤–è¡¨å …å¼·ï¼Œä½†åªæœ‰å°‘æ•¸äººèƒ½èµ°é€²ä½ çš„ä¸–ç•Œã€‚",
            "2. ä½ è¡¨é¢ä¸Šç¤¾äº¤è‡ªå¦‚ï¼Œä½†å¿ƒåº•å»å–œæ­¡ç¨è™•â€”â€”é€™ç¨®åå·®è®“ä½ é¡¯å¾—ç¥ç§˜è€Œé›£ä»¥æ‰æ‘¸ã€‚",
            "3. ä½ æ¸´æœ›èˆ‡çœ¾ä¸åŒï¼Œå»ä¹Ÿå®³æ€•è¢«æ’æ–¥ï¼Œå› æ­¤å¸¸åœ¨ã€Œåšè‡ªå·±ã€èˆ‡ã€Œè¢«æ¥ç´ã€ä¹‹é–“æ–æ“ºã€‚"
          ]
        },
        {
          title: "â˜€ï¸ ç›®æ¨™èˆ‡æˆé•·",
          items: [
            "4. ä½ å°æœªä¾†æœ‰å¾ˆå¤šå¤¢æƒ³èˆ‡è¨ˆç•«ï¼Œåªæ˜¯å¶çˆ¾ä¹Ÿæœƒè¢«ç¾å¯¦çš„å£“åŠ›æ‹‰å›åœ°é¢ã€‚",
            "5. ä½ å°è‡ªæˆ‘è¦æ±‚é«˜ï¼Œå¸¸å¸¸åçœèˆ‡æˆé•·ï¼Œå› ç‚ºä½ çŸ¥é“è‡ªå·±èƒ½æ¯”ç¾åœ¨æ›´å¥½ã€‚"
          ]
        },
        {
          title: "ğŸ’ äººéš›é—œä¿‚",
          items: [
            "6. ä½ åœ¨å‹æƒ…ä¸­çœŸèª åˆé‡æ„Ÿæƒ…ï¼Œåªæ˜¯æœ‰æ™‚ä¹Ÿæœƒæ‡·ç–‘å°æ–¹æ˜¯å¦åƒä½ ä¸€æ¨£åœ¨ä¹ã€‚",
            "7. ä½ ä¸å–œæ­¡è¢«æ§åˆ¶ï¼Œå»åˆå¸Œæœ›æœ‰äººèƒ½çµ¦ä½ å®‰å…¨æ„Ÿã€‚",
            "8. ä½ æ›¾ç¶“è¢«èª¤è§£éï¼Œå› æ­¤æ›´æ‡‚å¾—é«”è«’åˆ¥äººçš„æ„Ÿå—ã€‚"
          ]
        },
        {
          title: "ğŸŒŠ æƒ…ç·’èˆ‡æ„Ÿå—",
          items: [
            "9. ä½ å¾ˆæœ‰ç›´è¦ºï¼Œå¸¸èƒ½å¯Ÿè¦ºåˆ¥äººæƒ…ç·’çš„ç´°å¾®è®ŠåŒ–ï¼Œä½†é€™ä¹Ÿå®¹æ˜“è®“ä½ æ„Ÿåˆ°ç–²æ†Šã€‚",
            "10. ä½ é¢å°é¸æ“‡æ™‚æœƒçŒ¶è±«ä¸æ±ºï¼Œä¸æ˜¯å› ç‚ºä¸æ•¢å†’éšªï¼Œè€Œæ˜¯å› ç‚ºä½ çœŸçš„åœ¨ä¹çµæœã€‚"
          ]
        }
      ]
    };

    // å…¨å±€è®Šé‡
    let accuracyRating = 0;
    let selfRating = 0;
    let currentZodiacSymbol = "â™‹";
    let currentStep = 1;
    let userZodiacName = "";
    let db = null;
    
    // éŸ³æ•ˆç›¸é—œè®Šé‡
    let audioEnabled = true;
    let audioVolume = 0.5;
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const audioBuffers = {};

    // å±å¹•é–±è®€å™¨å°ˆç”¨åŠŸèƒ½
    function speakToScreenReader(message, priority = 'polite') {
      const liveRegion = document.createElement('div');
      liveRegion.setAttribute('aria-live', priority);
      liveRegion.setAttribute('aria-atomic', 'true');
      liveRegion.className = 'sr-only';
      liveRegion.textContent = message;
      document.body.appendChild(liveRegion);
      
      setTimeout(() => {
        document.body.removeChild(liveRegion);
      }, 1000);
    }

    // è™•ç†æ˜Ÿç´šè©•åˆ†çš„éµç›¤å°èˆª
    function handleStarKeydown(event, rating, type) {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        if (type === 'self') {
          rateSelf(rating);
        } else {
          rateAccuracy(rating);
        }
      } else if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
        event.preventDefault();
        navigateStars(event, type);
      }
    }

    // æ˜Ÿç´šè©•åˆ†éµç›¤å°èˆª
    function navigateStars(event, type) {
      const starsContainer = type === 'self' ? 
        document.getElementById('self-rating-stars') : 
        document.getElementById('accuracy-stars');
      
      const stars = starsContainer.querySelectorAll('[role="radio"]');
      const currentIndex = Array.from(stars).findIndex(star => 
        star.getAttribute('tabindex') === '0'
      );
      
      let newIndex;
      if (event.key === 'ArrowLeft') {
        newIndex = currentIndex > 0 ? currentIndex - 1 : stars.length - 1;
      } else {
        newIndex = currentIndex < stars.length - 1 ? currentIndex + 1 : 0;
      }
      
      // æ›´æ–°tabindex
      stars.forEach((star, index) => {
        star.setAttribute('tabindex', index === newIndex ? '0' : '-1');
      });
      
      // èšç„¦åˆ°æ–°çš„æ˜Ÿæ˜Ÿ
      stars[newIndex].focus();
    }

    // æ›´æ–°éŸ³æ•ˆåˆ‡æ›æŒ‰éˆ•çš„ARIAç‹€æ…‹
    function updateAudioToggleState() {
      const audioToggle = document.getElementById('audio-toggle');
      audioToggle.setAttribute('aria-pressed', audioEnabled.toString());
    }

    // æ›´æ–°æ¸¬é©—é¸é …çš„ARIAæ¨™ç±¤
    function updateQuizOptionsAccessibility() {
      const quizItems = document.querySelectorAll('.quiz-item');
      quizItems.forEach((item, index) => {
        const question = item.querySelector('.quiz-question');
        const options = item.querySelectorAll('.quiz-option');
        
        question.id = `question-${index}`;
        
        options.forEach((option, optIndex) => {
          option.setAttribute('aria-labelledby', `question-${index}`);
          option.setAttribute('role', 'radio');
          option.setAttribute('aria-checked', 'false');
          option.setAttribute('tabindex', optIndex === 0 ? '0' : '-1');
        });
      });
    }

    // æ›´æ–°é¸ä¸­ç‹€æ…‹çš„ARIA
    function updateSelectedOptionAria(selectedOption) {
      const question = selectedOption.getAttribute('data-q');
      const options = document.querySelectorAll(`.quiz-option[data-q="${question}"]`);
      
      options.forEach(option => {
        const isSelected = option === selectedOption;
        option.setAttribute('aria-checked', isSelected.toString());
        option.setAttribute('tabindex', isSelected ? '0' : '-1');
      });
    }

    // æ›´æ–°é€²åº¦æ¢çš„ARIAå€¼
    function updateQuizProgressAria() {
      const answered = document.querySelectorAll('.quiz-option.selected').length;
      const total = quizQuestions.length;
      const progress = (answered / total) * 100;
      
      const progressBar = document.getElementById('quiz-progress');
      progressBar.setAttribute('aria-valuenow', progress);
      progressBar.querySelector('.sr-only').textContent = `æ¸¬é©—é€²åº¦: ${Math.round(progress)}%`;
    }

    // OG åœ–ç‰‡ç”ŸæˆåŠŸèƒ½
    function generateOGImage() {
      const canvas = document.getElementById('og-canvas');
      const ctx = canvas.getContext('2d');
      
      // æ¸…é™¤ç•«å¸ƒ
      ctx.clearRect(0, 0, 1200, 630);
      
      // èƒŒæ™¯æ¼¸å±¤
      const gradient = ctx.createLinearGradient(0, 0, 1200, 630);
      gradient.addColorStop(0, '#667eea');
      gradient.addColorStop(0.5, '#764ba2');
      gradient.addColorStop(1, '#5a4fcf');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 1200, 630);
      
      // æ·»åŠ é–ƒçˆæ˜Ÿæ˜Ÿ
      ctx.fillStyle = '#ffffff';
      for (let i = 0; i < 80; i++) {
        const x = Math.random() * 1200;
        const y = Math.random() * 630;
        const size = Math.random() * 2.5 + 0.5;
        const opacity = Math.random() * 0.8 + 0.2;
        
        ctx.save();
        ctx.globalAlpha = opacity;
        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
      
      // æ·»åŠ å¤§æ˜Ÿæ˜Ÿï¼ˆè£é£¾ç”¨ï¼‰
      ctx.fillStyle = 'rgba(255,255,255,0.3)';
      for (let i = 0; i < 5; i++) {
        const x = 200 + Math.random() * 800;
        const y = 150 + Math.random() * 300;
        const size = Math.random() * 8 + 4;
        
        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // æ·»åŠ æ˜Ÿåº§ç¬¦è™ŸèƒŒæ™¯
      const zodiacSymbols = 'â™ˆâ™‰â™Šâ™‹â™Œâ™â™â™â™â™‘â™’â™“';
      ctx.fillStyle = 'rgba(255,255,255,0.08)';
      ctx.font = 'bold 70px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(zodiacSymbols, 600, 180);
      
      // æ·»åŠ ä¸»è¦æ¨™é¡Œ
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 82px "Segoe UI", Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      // æ–‡å­—é™°å½±
      ctx.shadowColor = 'rgba(0,0,0,0.5)';
      ctx.shadowBlur = 10;
      ctx.shadowOffsetX = 2;
      ctx.shadowOffsetY = 2;
      
      ctx.fillText('æ˜Ÿåº§äººæ ¼å¯¦é©—', 600, 280);
      
      // ç§»é™¤é™°å½±
      ctx.shadowColor = 'transparent';
      ctx.shadowBlur = 0;
      ctx.shadowOffsetX = 0;
      ctx.shadowOffsetY = 0;
      
      // æ·»åŠ å‰¯æ¨™é¡Œ
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.font = '42px "Segoe UI", Arial, sans-serif';
      ctx.fillText('å¿ƒç†å­¸å¯¦é©—æ¸¬é©—', 600, 360);
      
      // æ·»åŠ å‘¼ç±²è¡Œå‹•æŒ‰éˆ•æ•ˆæœ
      ctx.fillStyle = 'rgba(255,255,255,0.15)';
      ctx.beginPath();
      ctx.roundRect(450, 420, 300, 70, 35);
      ctx.fill();
      
      // æ·»åŠ å‘¼ç±²è¡Œå‹•æ–‡å­—
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 32px "Segoe UI", Arial, sans-serif';
      ctx.fillText('æ­é–‹æ˜Ÿåº§çš„çœŸç›¸', 600, 460);
      
      // æ·»åŠ ç¶²å€
      ctx.fillStyle = 'rgba(255,255,255,0.6)';
      ctx.font = '24px "Segoe UI", Arial, sans-serif';
      ctx.fillText('zodiac-experiment.com', 600, 550);
      
      // é¡¯ç¤ºç”Ÿæˆå™¨
      document.getElementById('og-generator').classList.add('active');
      
      console.log('OG åœ–ç‰‡ç”Ÿæˆå®Œæˆï¼');
      speakToScreenReader('OG åœ–ç‰‡å·²ç”Ÿæˆå®Œæˆ');
    }

    function downloadOGImage() {
      const canvas = document.getElementById('og-canvas');
      const link = document.createElement('a');
      link.download = 'og-image.jpg';
      link.href = canvas.toDataURL('image/jpeg', 0.92);
      link.click();
      alert('OG åœ–ç‰‡å·²ä¸‹è¼‰ï¼è«‹å°‡æª”æ¡ˆå‘½åç‚º og-image.jpg ä¸¦ä¸Šå‚³åˆ°æ‚¨çš„ç¶²ç«™ images æ–‡ä»¶å¤¾');
      speakToScreenReader('OG åœ–ç‰‡å·²ä¸‹è¼‰');
    }

    function closeOGGenerator() {
      document.getElementById('og-generator').classList.remove('active');
      speakToScreenReader('OG åœ–ç‰‡ç”Ÿæˆå™¨å·²é—œé–‰');
    }

    // å‹•æ…‹æ›´æ–° OG åœ–ç‰‡ URL
    function updateOGImageURL() {
      const currentURL = window.location.href;
      const baseURL = currentURL.split('/').slice(0, -1).join('/');
      const ogImageURL = `${baseURL}/images/og-image.jpg`;
      
      document.getElementById('dynamic-og-image').content = ogImageURL;
      document.getElementById('dynamic-twitter-image').content = ogImageURL;
    }

    // Firebase æ•¸æ“šæœå‹™
    const FirebaseService = {
      db: null,
      isInitialized: false,

      async init() {
        try {
          // åˆå§‹åŒ– Firebase
          firebase.initializeApp(firebaseConfig);
          this.db = firebase.firestore();
          this.isInitialized = true;
          console.log('Firebase åˆå§‹åŒ–æˆåŠŸ');
          return true;
        } catch (error) {
          console.error('Firebase åˆå§‹åŒ–å¤±æ•—:', error);
          this.isInitialized = false;
          return false;
        }
      },

      async uploadData(ratingData) {
        if (!this.isInitialized) {
          console.warn('Firebase æœªåˆå§‹åŒ–ï¼Œç„¡æ³•ä¸Šå‚³æ•¸æ“š');
          return false;
        }

        try {
          await this.db.collection('zodiac_ratings').add({
            ...ratingData,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            createdAt: new Date().toISOString()
          });
          console.log('æ•¸æ“šä¸Šå‚³æˆåŠŸ');
          return true;
        } catch (error) {
          console.error('æ•¸æ“šä¸Šå‚³å¤±æ•—:', error);
          return false;
        }
      },

      async getStatistics() {
        if (!this.isInitialized) {
          console.warn('Firebase æœªåˆå§‹åŒ–ï¼Œè¿”å›ç©ºæ•¸æ“š');
          return this.getEmptyStatistics();
        }

        try {
          const snapshot = await this.db.collection('zodiac_ratings').get();
          const allData = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          
          return this.calculateStatistics(allData);
        } catch (error) {
          console.error('ç²å–çµ±è¨ˆæ•¸æ“šå¤±æ•—:', error);
          return this.getEmptyStatistics();
        }
      },

      calculateStatistics(data) {
        if (data.length === 0) {
          return this.getEmptyStatistics();
        }

        const selfRatings = data.map(item => item.selfRating || 0);
        const accuracyRatings = data.map(item => item.accuracyRating || 0);
        
        // æŒ‰æ˜Ÿåº§åˆ†çµ„è¨ˆç®—
        const zodiacStats = {};
        data.forEach(item => {
          const zodiac = item.zodiac || 'æœªçŸ¥';
          if (!zodiacStats[zodiac]) {
            zodiacStats[zodiac] = {
              selfRatings: [],
              accuracyRatings: [],
              count: 0
            };
          }
          zodiacStats[zodiac].selfRatings.push(item.selfRating);
          zodiacStats[zodiac].accuracyRatings.push(item.accuracyRating);
          zodiacStats[zodiac].count++;
        });
        
        // è¨ˆç®—çµ±è¨ˆçµæœ
        const zodiacResults = {};
        Object.keys(zodiacStats).forEach(zodiac => {
          const stats = zodiacStats[zodiac];
          zodiacResults[zodiac] = {
            count: stats.count,
            avgSelf: this.calculateAverage(stats.selfRatings),
            avgAccuracy: this.calculateAverage(stats.accuracyRatings)
          };
        });
        
        return {
          totalParticipants: data.length,
          avgSelfRating: this.calculateAverage(selfRatings),
          avgAccuracyRating: this.calculateAverage(accuracyRatings),
          highSelfRatingPercent: this.calculateHighRatingPercent(selfRatings),
          zodiacStats: zodiacResults
        };
      },

      calculateAverage(numbers) {
        if (numbers.length === 0) return "0.00";
        const sum = numbers.reduce((acc, num) => acc + num, 0);
        return (sum / numbers.length).toFixed(2);
      },

      calculateHighRatingPercent(ratings) {
        if (ratings.length === 0) return "0.0";
        const highRatings = ratings.filter(rating => rating >= 4).length;
        return ((highRatings / ratings.length) * 100).toFixed(1);
      },

      getEmptyStatistics() {
        return {
          totalParticipants: 0,
          avgSelfRating: "0.00",
          avgAccuracyRating: "0.00",
          highSelfRatingPercent: "0.0",
          zodiacStats: {}
        };
      }
    };

    // éŸ³æ•ˆç³»çµ±
    const AudioSystem = {
      // åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±
      init() {
        this.loadSounds();
        this.setupAudioControls();
      },
      
      // åŠ è¼‰éŸ³æ•ˆ
      async loadSounds() {
        const soundTypes = ['click', 'hover', 'success', 'magic', 'star', 'transition'];
        
        for (const type of soundTypes) {
          try {
            audioBuffers[type] = await this.generateSound(type);
          } catch (error) {
            console.warn(`ç„¡æ³•ç”ŸæˆéŸ³æ•ˆ: ${type}`, error);
          }
        }
      },
      
      // ç”ŸæˆéŸ³æ•ˆ
      generateSound(type) {
        return new Promise((resolve) => {
          const buffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.5, audioContext.sampleRate);
          const data = buffer.getChannelData(0);
          
          switch(type) {
            case 'click':
              // çŸ­ä¿ƒçš„é»æ“Šè²
              for (let i = 0; i < buffer.length; i++) {
                data[i] = Math.sin(2 * Math.PI * 800 * i / audioContext.sampleRate) * 
                         Math.exp(-i / (audioContext.sampleRate * 0.01));
              }
              break;
              
            case 'hover':
              // æ‡¸åœæ™‚çš„è¼•æŸ”è²éŸ³
              for (let i = 0; i < buffer.length; i++) {
                data[i] = Math.sin(2 * Math.PI * 600 * i / audioContext.sampleRate) * 
                         Math.exp(-i / (audioContext.sampleRate * 0.05)) * 0.3;
              }
              break;
              
            case 'success':
              // æˆåŠŸéŸ³æ•ˆ
              for (let i = 0; i < buffer.length; i++) {
                const t = i / audioContext.sampleRate;
                data[i] = Math.sin(2 * Math.PI * 523.25 * t) * Math.exp(-t * 3) +
                          Math.sin(2 * Math.PI * 659.25 * t) * Math.exp(-t * 4) * 0.7 +
                          Math.sin(2 * Math.PI * 783.99 * t) * Math.exp(-t * 5) * 0.5;
              }
              break;
              
            case 'magic':
              // é­”æ³•éŸ³æ•ˆ
              for (let i = 0; i < buffer.length; i++) {
                const t = i / audioContext.sampleRate;
                data[i] = Math.sin(2 * Math.PI * 440 * t) * Math.exp(-t * 2) * 0.5 +
                          Math.sin(2 * Math.PI * 554.37 * t) * Math.exp(-t * 3) * 0.3 +
                          Math.sin(2 * Math.PI * 659.25 * t) * Math.exp(-t * 4) * 0.2;
              }
              break;
              
            case 'star':
              // æ˜Ÿæ˜Ÿé–ƒçˆéŸ³æ•ˆ
              for (let i = 0; i < buffer.length; i++) {
                const t = i / audioContext.sampleRate;
                data[i] = Math.sin(2 * Math.PI * 1000 * t) * Math.exp(-t * 8) * 0.4 +
                          Math.sin(2 * Math.PI * 1200 * t) * Math.exp(-t * 10) * 0.3;
              }
              break;
              
            case 'transition':
              // éæ¸¡éŸ³æ•ˆ
              for (let i = 0; i < buffer.length; i++) {
                const t = i / audioContext.sampleRate;
                data[i] = Math.sin(2 * Math.PI * 200 * (1 + t * 2) * t) * Math.exp(-t * 2);
              }
              break;
          }
          
          resolve(buffer);
        });
      },
      
      // æ’­æ”¾éŸ³æ•ˆ
      playSound(type) {
        if (!audioEnabled || !audioBuffers[type]) return;
        
        const source = audioContext.createBufferSource();
        const gainNode = audioContext.createGain();
        
        source.buffer = audioBuffers[type];
        gainNode.gain.value = audioVolume;
        
        source.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        source.start();
      },
      
      // è¨­ç½®éŸ³æ•ˆæ§åˆ¶
      setupAudioControls() {
        const toggleBtn = document.getElementById('audio-toggle');
        const volumeSlider = document.getElementById('audio-volume');
        
        toggleBtn.addEventListener('click', () => {
          audioEnabled = !audioEnabled;
          toggleBtn.classList.toggle('muted', !audioEnabled);
          updateAudioToggleState();
          this.playSound('click');
          speakToScreenReader(`éŸ³æ•ˆ${audioEnabled ? 'é–‹å•Ÿ' : 'é—œé–‰'}`);
        });
        
        volumeSlider.addEventListener('input', (e) => {
          audioVolume = e.target.value / 100;
          volumeSlider.setAttribute('aria-valuenow', e.target.value);
          this.playSound('hover');
        });
        
        // ç‚ºæŒ‰éˆ•æ·»åŠ éŸ³æ•ˆ
        document.addEventListener('click', (e) => {
          if (e.target.tagName === 'BUTTON' && !e.target.id.includes('audio')) {
            this.playSound('click');
          }
        });
        
        // ç‚ºé¸é …æ·»åŠ æ‡¸åœéŸ³æ•ˆ
        document.addEventListener('mouseover', (e) => {
          if ((e.target.classList.contains('quiz-option') || 
               e.target.classList.contains('rating-star') ||
               e.target.classList.contains('self-rating-star')) && 
              !e.target.classList.contains('selected') && 
              !e.target.classList.contains('active')) {
            this.playSound('hover');
          }
        });
      }
    };

    // çœŸç›¸æ­é–‹ç‰¹æ•ˆ
    function startTruthReveal() {
      const mask = document.getElementById('truth-mask');
      const content = document.getElementById('reveal-content');
      const explosion = document.getElementById('truth-explosion');
      const matrixRain = document.getElementById('matrix-rain');
      
      // æ’­æ”¾ç‰¹æ®ŠéŸ³æ•ˆ
      AudioSystem.playSound('magic');
      speakToScreenReader('çœŸç›¸å³å°‡æ­æ›‰ï¼Œæº–å‚™ç‰¹æ•ˆå‹•ç•«', 'assertive');
      
      // ç¬¬ä¸€æ­¥ï¼šè£‚ç—•å‡ºç¾
      setTimeout(() => {
        createCracks();
        AudioSystem.playSound('star');
      }, 1000);
      
      // ç¬¬äºŒæ­¥ï¼šè£‚ç—•æ“´æ•£
      setTimeout(() => {
        expandCracks();
        AudioSystem.playSound('transition');
      }, 1500);
      
      // ç¬¬ä¸‰æ­¥ï¼šçˆ†ç‚¸æ•ˆæœ
      setTimeout(() => {
        createExplosion();
        createMatrixRain();
        AudioSystem.playSound('success');
      }, 2500);
      
      // ç¬¬å››æ­¥ï¼šé®ç½©ç ´ç¢ï¼Œå…§å®¹é¡¯ç¤º
      setTimeout(() => {
        mask.style.opacity = '0';
        mask.style.transform = 'scale(1.5) rotate(10deg)';
        mask.style.transition = 'all 1s ease-out';
        
        content.style.opacity = '1';
        content.classList.add('truth-revealed');
        
        // å•Ÿå‹•æ–‡å­—æ•…éšœæ•ˆæœ
        startGlitchEffect();
        
        speakToScreenReader('çœŸç›¸å·²æ­æ›‰ï¼šæ¯å€‹äººçš„æ˜Ÿåº§å ±å‘Šéƒ½æ˜¯ä¸€æ¨£çš„ï¼Œé€™æ˜¯å·´ç´å§†æ•ˆæ‡‰çš„å¿ƒç†å­¸å¯¦é©—');
        
      }, 3000);
      
      // ç¬¬äº”æ­¥ï¼šæ¸…ç†ç‰¹æ•ˆå…ƒç´ 
      setTimeout(() => {
        mask.remove();
        setTimeout(() => {
          explosion.innerHTML = '';
          matrixRain.innerHTML = '';
          matrixRain.style.opacity = '0';
        }, 2000);
      }, 4000);
    }

    // å‰µå»ºè£‚ç—•
    function createCracks() {
      const cracks = [
        { id: 'crack-1', left: '50%', top: '30%' },
        { id: 'crack-2', left: '40%', top: '50%' },
        { id: 'crack-3', left: '50%', top: '50%' },
        { id: 'crack-4', left: '60%', top: '50%' }
      ];
      
      cracks.forEach(crack => {
        const element = document.getElementById(crack.id);
        element.style.left = crack.left;
        element.style.top = crack.top;
        element.style.opacity = '1';
        element.style.transition = 'all 0.5s ease-out';
      });
    }

    // æ“´æ•£è£‚ç—•
    function expandCracks() {
      document.getElementById('crack-1').style.width = '100%';
      document.getElementById('crack-2').style.height = '100%';
      document.getElementById('crack-3').style.height = '200%';
      document.getElementById('crack-4').style.height = '200%';
      
      // å‰µå»ºç¢ç‰‡
      createShards();
    }

    // å‰µå»ºç¢ç‰‡
    function createShards() {
      const shards = [
        { id: 'shard-1', left: '20%', top: '20%', size: '15px' },
        { id: 'shard-2', left: '80%', top: '30%', size: '20px' },
        { id: 'shard-3', left: '30%', top: '70%', size: '12px' },
        { id: 'shard-4', left: '70%', top: '80%', size: '18px' }
      ];
      
      shards.forEach(shard => {
        const element = document.getElementById(shard.id);
        element.style.left = shard.left;
        element.style.top = shard.top;
        element.style.width = shard.size;
        element.style.height = shard.size;
        element.style.opacity = '1';
        element.style.boxShadow = '0 0 10px 2px white';
      });
    }

    // å‰µå»ºçˆ†ç‚¸ç²’å­
    function createExplosion() {
      const explosion = document.getElementById('truth-explosion');
      const particleCount = 50;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // éš¨æ©Ÿä½ç½®
        const left = 40 + Math.random() * 20;
        const top = 40 + Math.random() * 20;
        
        particle.style.left = `${left}%`;
        particle.style.top = `${top}%`;
        
        // éš¨æ©Ÿé¡è‰²
        const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
        particle.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        // éš¨æ©Ÿå‹•ç•«
        const angle = Math.random() * 360;
        const distance = 50 + Math.random() * 100;
        const duration = 1 + Math.random() * 2;
        
        particle.style.animation = `
          particleExplode ${duration}s ease-out forwards
        `;
        
        particle.style.setProperty('--angle', `${angle}deg`);
        particle.style.setProperty('--distance', `${distance}px`);
        
        explosion.appendChild(particle);
      }
      
      // æ·»åŠ CSSå‹•ç•«
      if (!document.getElementById('particle-animation')) {
        const style = document.createElement('style');
        style.id = 'particle-animation';
        style.textContent = `
          @keyframes particleExplode {
            0% {
              opacity: 1;
              transform: translate(0, 0) scale(1);
            }
            100% {
              opacity: 0;
              transform: translate(
                calc(cos(var(--angle)) * var(--distance)),
                calc(sin(var(--angle)) * var(--distance))
              ) scale(0);
            }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // å‰µå»ºçŸ©é™£é›¨æ•ˆæœ
    function createMatrixRain() {
      const matrixRain = document.getElementById('matrix-rain');
      matrixRain.style.opacity = '0.3';
      
      const chars = '01ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³ã‚µã‚·ã‚¹ã‚»ã‚½ã‚¿ãƒãƒ„ãƒ†ãƒˆãƒŠãƒ‹ãƒŒãƒãƒãƒãƒ’ãƒ•ãƒ˜ãƒ›ãƒãƒŸãƒ ãƒ¡ãƒ¢ãƒ¤ãƒ¦ãƒ¨ãƒ©ãƒªãƒ«ãƒ¬ãƒ­ãƒ¯ãƒ²ãƒ³';
      const charCount = 100;
      
      for (let i = 0; i < charCount; i++) {
        const char = document.createElement('div');
        char.className = 'rain-char';
        char.textContent = chars[Math.floor(Math.random() * chars.length)];
        
        char.style.left = `${Math.random() * 100}%`;
        char.style.animationDelay = `${Math.random() * 5}s`;
        char.style.animation = `rainFall ${2 + Math.random() * 3}s linear infinite`;
        
        matrixRain.appendChild(char);
      }
      
      // æ·»åŠ çŸ©é™£é›¨å‹•ç•«
      if (!document.getElementById('matrix-animation')) {
        const style = document.createElement('style');
        style.id = 'matrix-animation';
        style.textContent = `
          @keyframes rainFall {
            0% {
              opacity: 0;
              transform: translateY(-100px);
            }
            10% {
              opacity: 1;
            }
            90% {
              opacity: 1;
            }
            100% {
              opacity: 0;
              transform: translateY(100vh);
            }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // å•Ÿå‹•æ–‡å­—æ•…éšœæ•ˆæœ
    function startGlitchEffect() {
      const glitchTexts = document.querySelectorAll('.glitch-text');
      glitchTexts.forEach(text => {
        text.style.animation = 'none';
        setTimeout(() => {
          text.style.animation = 'glitch-1 0.5s infinite linear alternate-reverse';
        }, 100);
      });
      
      // 5ç§’å¾Œåœæ­¢æ•…éšœæ•ˆæœ
      setTimeout(() => {
        glitchTexts.forEach(text => {
          text.style.animation = 'none';
        });
      }, 5000);
    }

    // åœ¨é é¢åŠ è¼‰æ™‚åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('é é¢åŠ è¼‰å®Œæˆï¼Œåˆå§‹åŒ–...');
        
        const monthSelect = document.getElementById('birth-month');
        monthSelect.addEventListener('change', updateDayOptions);
        updateDayOptions();
        createStars();
        createConstellation();
        startShootingStars();
        updateProgressIndicator();
        
        // åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±
        AudioSystem.init();
        
        // åˆå§‹åŒ– Firebase
        try {
          await FirebaseService.init();
          console.log('ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
        } catch (error) {
          console.error('åˆå§‹åŒ–éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);
        }
        
        // æ›´æ–° OG åœ–ç‰‡ URL
        updateOGImageURL();

        // è¨­ç½®å¯è¨ªå•æ€§åŠŸèƒ½
        setupAccessibility();
        
        speakToScreenReader('æ˜Ÿåº§äººæ ¼å¯¦é©—é é¢å·²è¼‰å…¥å®Œæˆï¼Œè«‹è¼¸å…¥æ‚¨çš„ç”Ÿæ—¥é–‹å§‹æ¸¬é©—');
    });

    // è¨­ç½®å¯è¨ªå•æ€§åŠŸèƒ½
    function setupAccessibility() {
      // ç‚ºå‹•æ…‹å…§å®¹æ·»åŠ ARIAå¯¦æ™‚å€åŸŸ
      const reportContainer = document.getElementById('report');
      reportContainer.setAttribute('aria-live', 'polite');
      reportContainer.setAttribute('aria-atomic', 'false');
      
      // çµ±è¨ˆå€åŸŸæ·»åŠ å¯¦æ™‚å€åŸŸ
      const statsContainer = document.querySelector('.statistics-section');
      if (statsContainer) {
        statsContainer.setAttribute('aria-live', 'polite');
        statsContainer.setAttribute('aria-atomic', 'true');
      }
      
      // ç‚ºæ‰€æœ‰æŒ‰éˆ•æ·»åŠ åŸºæœ¬çš„ARIAæ¨™ç±¤ï¼ˆå¦‚æœç¼ºå°‘ï¼‰
      document.querySelectorAll('button').forEach(button => {
        if (!button.getAttribute('aria-label') && !button.textContent.trim()) {
          button.setAttribute('aria-label', 'æŒ‰éˆ•');
        }
      });
    }

    // æ›´æ–°æ—¥æœŸé¸é …
    function updateDayOptions() {
        const monthSelect = document.getElementById('birth-month');
        const daySelect = document.getElementById('birth-day');
        const selectedMonth = parseInt(monthSelect.value);
        
        daySelect.innerHTML = '<option value="">è«‹é¸æ“‡</option>';
        
        if (!selectedMonth) return;
        
        let daysInMonth = 31;
        if (selectedMonth === 2) {
            daysInMonth = 29;
        } else if ([4, 6, 9, 11].includes(selectedMonth)) {
            daysInMonth = 30;
        }
        
        for (let i = 1; i <= daysInMonth; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i + 'æ—¥';
            daySelect.appendChild(option);
        }
    }

    // æ›´æ–°é€²åº¦æŒ‡ç¤ºå™¨
    function updateProgressIndicator() {
        const steps = document.querySelectorAll('.progress-step');
        steps.forEach((step, index) => {
            step.classList.remove('active', 'completed');
            if (index + 1 === currentStep) {
                step.classList.add('active');
                step.setAttribute('aria-current', 'step');
            } else if (index + 1 < currentStep) {
                step.classList.add('completed');
                step.removeAttribute('aria-current');
            } else {
                step.removeAttribute('aria-current');
            }
        });
    }

    // å‰µå»ºæ˜Ÿç©ºèƒŒæ™¯
    function createStars() {
        const starsContainer = document.getElementById('stars-background');
        const starCount = 80;
        
        for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.classList.add('background-star');
            
            const size = Math.random() * 1.5 + 0.5;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            
            star.style.setProperty('--duration', `${8 + Math.random() * 12}s`);
            star.style.setProperty('--delay', `${Math.random() * 15}s`);
            
            starsContainer.appendChild(star);
        }
    }

    // å‰µå»ºæ˜Ÿåº§é€£ç·š
    function createConstellation() {
        const constellation = document.getElementById('constellation');
        const lineCount = 6;
        
        for (let i = 0; i < lineCount; i++) {
            const line = document.createElement('div');
            line.classList.add('constellation-line');
            
            const x1 = Math.random() * 100;
            const y1 = Math.random() * 100;
            const length = 50 + Math.random() * 80;
            const angle = Math.random() * 360;
            
            line.style.left = `${x1}%`;
            line.style.top = `${y1}%`;
            line.style.width = `${length}px`;
            line.style.transform = `rotate(${angle}deg)`;
            line.style.animationDelay = `${Math.random() * 10}s`;
            
            constellation.appendChild(line);
        }
    }

    // æµæ˜Ÿæ•ˆæœ
    function startShootingStars() {
        setInterval(() => {
            createShootingStar();
        }, 8000);
    }

    function createShootingStar() {
        const shootingStar = document.createElement('div');
        shootingStar.classList.add('shooting-star');
        
        const startX = Math.random() * 100;
        const startY = Math.random() * 50;
        
        shootingStar.style.left = `${startX}%`;
        shootingStar.style.top = `${startY}%`;
        
        document.body.appendChild(shootingStar);
        
        shootingStar.style.animation = `shoot 2s linear forwards`;
        
        setTimeout(() => {
            shootingStar.remove();
        }, 2000);
    }

    // éŒ¯èª¤è™•ç†
    function showError(message, elementId) {
        const errorElement = document.getElementById(elementId);
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 3000);
        }
        speakToScreenReader(`éŒ¯èª¤ï¼š${message}`, 'assertive');
    }

    // æˆåŠŸè¨Šæ¯
    function showSuccess(message, elementId) {
        const successElement = document.getElementById(elementId);
        if (successElement) {
            successElement.textContent = message;
            successElement.style.display = 'block';
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }
        speakToScreenReader(message);
    }

    // æ—¥æœŸé©—è­‰
    function isValidDate(month, day) {
        const daysInMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        return day > 0 && day <= daysInMonth[month - 1];
    }

    // åŠ è¼‰ç‹€æ…‹æ§åˆ¶
    function showLoading() {
        document.getElementById('loading-overlay').style.display = 'flex';
    }

    function hideLoading() {
        document.getElementById('loading-overlay').style.display = 'none';
    }

    // æ˜Ÿåº§åˆ¤æ–·
    function getZodiacSign(month, day) {
        for (let sign of zodiacSigns) {
            const [startM, startD] = sign.start;
            const [endM, endD] = sign.end;
            
            if (startM === 12 && endM === 1) {
                if ((month === 12 && day >= startD) || (month === 1 && day <= endD)) {
                    return sign;
                }
            } 
            else if (month === startM && day >= startD) {
                return sign;
            }
            else if (month === endM && day <= endD) {
                return sign;
            }
        }
        return null;
    }

    // æäº¤ç”Ÿæ—¥
    function submitBirthday() {
        const month = parseInt(document.getElementById("birth-month").value);
        const day = parseInt(document.getElementById("birth-day").value);
        
        if (!month || !day) {
            showError("è«‹é¸æ“‡å®Œæ•´çš„ç”Ÿæ—¥æ—¥æœŸ", "birthday-error");
            return;
        }
        
        if (!isValidDate(month, day)) {
            showError("è«‹é¸æ“‡æœ‰æ•ˆçš„æ—¥æœŸ", "birthday-error");
            return;
        }
        
        const sign = getZodiacSign(month, day);
        if (!sign) {
            showError("ç„¡æ³•ç¢ºå®šæ˜Ÿåº§ï¼Œè«‹æª¢æŸ¥è¼¸å…¥çš„æ—¥æœŸ", "birthday-error");
            return;
        }
        
        showLoading();
        AudioSystem.playSound('magic');
        
        setTimeout(() => {
            const zodiacName = document.getElementById("zodiac-name");
            const zodiacDates = document.getElementById("zodiac-dates");
            
            zodiacName.innerHTML = `${sign.symbol} ç»çµ¦ç¨ä¸€ç„¡äºŒçš„${sign.name} ${sign.symbol}`;
            zodiacName.classList.add("flash");
            
            zodiacDates.textContent = `${sign.start[0]}æœˆ${sign.start[1]}æ—¥ - ${sign.end[0]}æœˆ${sign.end[1]}æ—¥ | ${sign.element}è±¡æ˜Ÿåº§`;
            
            currentZodiacSymbol = sign.symbol;
            userZodiacName = sign.name;
            
            document.getElementById("step-birthday").classList.add("hidden");
            document.getElementById("step-zodiac").classList.remove("hidden");
            
            currentStep = 2;
            updateProgressIndicator();
            
            hideLoading();
            AudioSystem.playSound('success');
            
            speakToScreenReader(`æ‚¨çš„æ˜Ÿåº§æ˜¯${sign.name}ï¼Œæ—¥æœŸç¯„åœç‚º${sign.start[0]}æœˆ${sign.start[1]}æ—¥åˆ°${sign.end[0]}æœˆ${sign.end[1]}æ—¥ï¼Œ${sign.element}è±¡æ˜Ÿåº§`);
        }, 1000);
    }

    // é–‹å§‹æ¸¬é©—
    function startQuiz() {
        const quizContainer = document.getElementById("quiz-form");
        quizContainer.innerHTML = "";
        
        for (let i = 0; i < quizQuestions.length; i++) {
            const div = document.createElement("div");
            div.className = "quiz-item";
            div.innerHTML = `
                <div class="quiz-question">${i+1}. ${quizQuestions[i]}</div>
                <div class="quiz-options">
                    ${quizOptions[i].map((option, idx) => 
                        `<div class="quiz-option" data-q="${i}" data-a="${idx}">${option}</div>`
                    ).join('')}
                </div>
            `;
            quizContainer.appendChild(div);
        }
        
        document.querySelectorAll('.quiz-option').forEach(option => {
            option.addEventListener('click', function() {
                const question = this.getAttribute('data-q');
                document.querySelectorAll(`.quiz-option[data-q="${question}"]`).forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                AudioSystem.playSound('star');
                updateQuizProgress();
                updateSelectedOptionAria(this);
                
                const questionText = this.closest('.quiz-item').querySelector('.quiz-question').textContent;
                speakToScreenReader(`å·²é¸æ“‡ï¼š${this.textContent}ï¼Œå•é¡Œï¼š${questionText}`);
            });
        });
        
        document.getElementById("step-zodiac").classList.add("hidden");
        document.getElementById("step-quiz").classList.remove("hidden");
        
        const items = document.querySelectorAll(".quiz-item");
        items.forEach((item, index) => {
            setTimeout(() => { 
                item.style.opacity = 1; 
                item.style.transform = "translateY(0)";
            }, index * 100);
        });
        
        updateQuizOptionsAccessibility();
        updateQuizProgress();
        AudioSystem.playSound('transition');
        
        currentStep = 3;
        updateProgressIndicator();
        
        speakToScreenReader('äººæ ¼æ¸¬é©—é–‹å§‹ï¼Œå…±æœ‰15å€‹å•é¡Œï¼Œè«‹ä½¿ç”¨æ–¹å‘éµæˆ–é»æ“Šé¸æ“‡ç­”æ¡ˆ');
    }

    // æ›´æ–°æ¸¬é©—é€²åº¦
    function updateQuizProgress() {
        const answered = document.querySelectorAll('.quiz-option.selected').length;
        const total = quizQuestions.length;
        const progress = (answered / total) * 100;
        
        document.getElementById('quiz-progress').style.width = `${progress}%`;
        
        if (answered === total) {
            document.getElementById('quiz-submit').classList.remove('hidden');
            AudioSystem.playSound('success');
            speakToScreenReader('æ‰€æœ‰å•é¡Œå·²å›ç­”å®Œæˆï¼Œè«‹é»æ“Šå®Œæˆæ¸¬é©—æŒ‰éˆ•');
        } else {
            document.getElementById('quiz-submit').classList.add('hidden');
        }
        
        updateQuizProgressAria();
    }

    // æäº¤æ¸¬é©—
    function submitQuiz() {
        document.getElementById("step-quiz").classList.add("hidden");
        document.getElementById("step-analyzing").classList.remove("hidden");
        
        document.getElementById("analyzing-zodiac-icon").textContent = currentZodiacSymbol;
        
        AudioSystem.playSound('magic');
        speakToScreenReader('æ­£åœ¨åˆ†ææ‚¨çš„æ¸¬é©—çµæœï¼Œè«‹ç¨å€™...');
        
        setTimeout(showFinalReport, 3000);
        
        currentStep = 4;
        updateProgressIndicator();
    }

    // é¡¯ç¤ºæœ€çµ‚å ±å‘Š
    function showFinalReport() {
        document.getElementById("step-analyzing").classList.add("hidden");
        document.getElementById("step-report").classList.remove("hidden");
        
        const reportContainer = document.getElementById("report");
        reportContainer.innerHTML = `<h3>${universalReport.title}</h3>`;
        
        universalReport.categories.forEach((category, categoryIndex) => {
            const categoryDiv = document.createElement("div");
            categoryDiv.className = "report-category";
            
            const categoryTitle = document.createElement("div");
            categoryTitle.className = "category-title";
            categoryTitle.textContent = category.title;
            categoryDiv.appendChild(categoryTitle);
            
            category.items.forEach((item, itemIndex) => {
                const p = document.createElement("p");
                p.textContent = item;
                p.style.opacity = "0";
                p.style.transform = "translateY(20px)";
                p.style.transition = "all 0.6s ease";
                categoryDiv.appendChild(p);
                
                setTimeout(() => {
                    p.style.opacity = "1";
                    p.style.transform = "translateY(0)";
                    AudioSystem.playSound('star');
                }, (categoryIndex * 300) + (itemIndex * 200));
            });
            
            reportContainer.appendChild(categoryDiv);
            
            if (categoryIndex < universalReport.categories.length - 1) {
                const divider = document.createElement("div");
                divider.className = "category-divider";
                reportContainer.appendChild(divider);
            }
            
            setTimeout(() => {
                categoryDiv.style.opacity = "1";
                categoryDiv.style.transform = "translateY(0)";
            }, categoryIndex * 400);
        });
        
        // ç‚ºå ±å‘Šå…§å®¹æ·»åŠ é©ç•¶çš„èªç¾©æ¨™è¨˜
        const reportCategories = document.querySelectorAll('.report-category');
        reportCategories.forEach((category, index) => {
            category.setAttribute('role', 'region');
            const title = category.querySelector('.category-title');
            if (title) {
                category.setAttribute('aria-labelledby', `category-title-${index}`);
                title.id = `category-title-${index}`;
            }
        });
        
        AudioSystem.playSound('success');
        speakToScreenReader('æ˜Ÿåº§äººæ ¼å ±å‘Šå·²ç”Ÿæˆå®Œæˆï¼Œè«‹é–±è®€å ±å‘Šå…§å®¹ä¸¦é€²è¡Œè©•åˆ†');
    }

    // é€™å°±æ˜¯æˆ‘è©•åˆ†
    function rateSelf(rating) {
        selfRating = rating;
        const stars = document.querySelectorAll('#self-rating-stars .self-rating-star');
        stars.forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
                star.setAttribute('aria-checked', 'true');
            } else {
                star.classList.remove('active');
                star.setAttribute('aria-checked', 'false');
            }
        });
        AudioSystem.playSound('star');
        speakToScreenReader(`é€™å°±æ˜¯æˆ‘è©•åˆ†ï¼š${rating}åˆ†`);
    }

    // æ¸¬é©—æº–ç¢ºåº¦è©•åˆ†
    function rateAccuracy(rating) {
        accuracyRating = rating;
        const stars = document.querySelectorAll('#accuracy-stars .rating-star');
        stars.forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
                star.setAttribute('aria-checked', 'true');
            } else {
                star.classList.remove('active');
                star.setAttribute('aria-checked', 'false');
            }
        });
        AudioSystem.playSound('star');
        speakToScreenReader(`æ¸¬é©—æº–ç¢ºåº¦è©•åˆ†ï¼š${rating}åˆ†`);
    }

    // æäº¤åé¥‹
    async function submitFeedback() {
        if (selfRating === 0) {
            showError("è«‹å…ˆç‚ºã€é€™å°±æ˜¯æˆ‘ã€è©•åˆ†", "feedback-error");
            return;
        }
        
        if (accuracyRating === 0) {
            showError("è«‹å…ˆç‚ºæ¸¬é©—æº–ç¢ºåº¦è©•åˆ†", "feedback-error");
            return;
        }
        
        if (confirm(`æ‚¨ç¢ºå®šè¦æäº¤è©•åˆ†å—ï¼Ÿ\nã€é€™å°±æ˜¯æˆ‘ã€: ${selfRating} åˆ†\næ¸¬é©—æº–ç¢ºåº¦: ${accuracyRating} åˆ†`)) {
            showLoading();
            AudioSystem.playSound('magic');
            
            try {
                // æº–å‚™è©•åˆ†æ•¸æ“š
                const ratingData = {
                    selfRating: selfRating,
                    accuracyRating: accuracyRating,
                    zodiac: userZodiacName,
                    userAgent: navigator.userAgent,
                    screenSize: `${screen.width}x${screen.height}`,
                    language: navigator.language,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                };
                
                // ä¸Šå‚³æ•¸æ“šåˆ° Firebase
                const uploadSuccess = await FirebaseService.uploadData(ratingData);
                
                if (uploadSuccess) {
                    showSuccess("è©•åˆ†æäº¤æˆåŠŸï¼", "feedback-success");
                } else {
                    showSuccess("è©•åˆ†æäº¤å®Œæˆï¼ˆé›¢ç·šæ¨¡å¼ï¼‰", "feedback-success");
                }
                
                // å»¶é²ä¸€ä¸‹è®“ç”¨æˆ¶çœ‹åˆ°æˆåŠŸè¨Šæ¯
                setTimeout(() => {
                    document.getElementById("step-report").classList.add("hidden");
                    document.getElementById("step-reveal").classList.remove("hidden");
                    
                    // å•Ÿå‹•çœŸç›¸æ­é–‹ç‰¹æ•ˆ
                    setTimeout(startTruthReveal, 500);
                    
                    currentStep = 5;
                    updateProgressIndicator();
                    
                    hideLoading();
                }, 1000);
                
            } catch (error) {
                console.error('æäº¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);
                showError("æäº¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤", "feedback-error");
                hideLoading();
            }
        }
    }

    // é¡¯ç¤ºçµ±è¨ˆæ•¸æ“šé é¢
    async function showStatistics() {
        showLoading();
        AudioSystem.playSound('transition');
        
        try {
            const stats = await FirebaseService.getStatistics();
            updateStatisticsDisplay(stats);
            
            document.getElementById("step-reveal").classList.add("hidden");
            document.getElementById("step-statistics").classList.remove("hidden");
            
            currentStep = 6;
            updateProgressIndicator();
            
            speakToScreenReader('çµ±è¨ˆæ•¸æ“šé é¢å·²è¼‰å…¥ï¼Œé¡¯ç¤ºæ‰€æœ‰åƒèˆ‡è€…çš„è©•åˆ†æ•¸æ“š');
            
        } catch (error) {
            console.error('é¡¯ç¤ºçµ±è¨ˆæ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            showError("ç„¡æ³•è¼‰å…¥çµ±è¨ˆæ•¸æ“š", "feedback-error");
        } finally {
            hideLoading();
        }
    }

    // æ›´æ–°çµ±è¨ˆé¡¯ç¤º
    function updateStatisticsDisplay(stats) {
        document.getElementById('total-participants').textContent = stats.totalParticipants.toLocaleString();
        document.getElementById('avg-self-rating').textContent = stats.avgSelfRating;
        document.getElementById('avg-accuracy-rating').textContent = stats.avgAccuracyRating;
        document.getElementById('high-self-rating-percent').textContent = stats.highSelfRatingPercent + '%';
        
        // é¡¯ç¤ºæ˜Ÿåº§æ¯”è¼ƒ
        displayZodiacComparison(stats.zodiacStats);
        
        AudioSystem.playSound('success');
        
        speakToScreenReader(`çµ±è¨ˆæ•¸æ“šæ›´æ–°ï¼šç¸½åƒèˆ‡äººæ•¸${stats.totalParticipants}äººï¼Œå¹³å‡èªåŒåº¦${stats.avgSelfRating}åˆ†ï¼Œå¹³å‡æº–ç¢ºåº¦${stats.avgAccuracyRating}åˆ†ï¼Œé«˜èªåŒåº¦æ¯”ä¾‹${stats.highSelfRatingPercent}%`);
    }

    // é¡¯ç¤ºæ˜Ÿåº§æ¯”è¼ƒ
    function displayZodiacComparison(zodiacStats) {
        const container = document.getElementById('zodiac-comparison-content');
        if (!container) return;
        
        container.innerHTML = '';
        
        if (Object.keys(zodiacStats).length === 0) {
            const emptyMsg = document.createElement('div');
            emptyMsg.className = 'zodiac-stat-item';
            emptyMsg.innerHTML = '<div class="zodiac-name">æš«ç„¡æ•¸æ“š</div><div class="zodiac-data"><span class="stat">ç­‰å¾…æ›´å¤šåƒèˆ‡è€…</span></div>';
            container.appendChild(emptyMsg);
            return;
        }
        
        // æŒ‰å‚ä¸äººæ•°æ’åº
        const sortedZodiacs = Object.keys(zodiacStats).sort((a, b) => {
            return zodiacStats[b].count - zodiacStats[a].count;
        });
        
        sortedZodiacs.forEach(zodiac => {
            const stat = zodiacStats[zodiac];
            const item = document.createElement('div');
            item.className = 'zodiac-stat-item';
            item.setAttribute('role', 'listitem');
            
            item.innerHTML = `
                <div class="zodiac-name">${zodiac}</div>
                <div class="zodiac-data">
                    <span class="stat">${stat.count} äºº</span>
                    <span class="stat">èªåŒåº¦: ${stat.avgSelf}</span>
                    <span class="stat">æº–ç¢ºåº¦: ${stat.avgAccuracy}</span>
                </div>
            `;
            
            container.appendChild(item);
        });
    }

    // åˆ†äº«åŠŸèƒ½
    function shareOnFacebook() {
        const text = document.getElementById('share-result-text').textContent;
        const url = window.location.href;
        const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`;
        window.open(shareUrl, '_blank', 'width=600,height=400');
        AudioSystem.playSound('click');
        speakToScreenReader('é–‹å•Ÿ Facebook åˆ†äº«è¦–çª—');
    }

    function shareOnTwitter() {
        const text = document.getElementById('share-result-text').textContent;
        const url = window.location.href;
        const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text + ' ' + url)}`;
        window.open(shareUrl, '_blank', 'width=600,height=400');
        AudioSystem.playSound('click');
        speakToScreenReader('é–‹å•Ÿ Twitter åˆ†äº«è¦–çª—');
    }

    function shareOnLine() {
        const text = document.getElementById('share-result-text').textContent;
        const url = window.location.href;
        const shareUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
        window.open(shareUrl, '_blank', 'width=600,height=400');
        AudioSystem.playSound('click');
        speakToScreenReader('é–‹å•Ÿ LINE åˆ†äº«è¦–çª—');
    }

    function copyShareLink() {
        const text = document.getElementById('share-result-text').textContent;
        const url = window.location.href;
        const shareText = `${text}\n\n${url}`;
        
        navigator.clipboard.writeText(shareText).then(() => {
            showSuccess('é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'feedback-success');
            AudioSystem.playSound('success');
            speakToScreenReader('åˆ†äº«é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
        }).catch(err => {
            console.error('è¤‡è£½å¤±æ•—:', err);
            showError('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½', 'feedback-error');
            speakToScreenReader('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½é€£çµ');
        });
    }

    // é‡æ–°é–‹å§‹å¯¦é©—
    function restartExperiment() {
        // é‡ç½®æ‰€æœ‰è¡¨å–®å’Œç‹€æ…‹
        document.getElementById('birth-month').value = '';
        document.getElementById('birth-day').innerHTML = '<option value="">è«‹é¸æ“‡</option>';
        
        // é‡ç½®è©•åˆ†æ˜Ÿæ˜Ÿ
        const selfStars = document.querySelectorAll('#self-rating-stars .self-rating-star');
        selfStars.forEach(star => {
            star.classList.remove('active');
            star.setAttribute('aria-checked', 'false');
            star.setAttribute('tabindex', '-1');
        });
        selfStars[0].setAttribute('tabindex', '0');
        
        const accuracyStars = document.querySelectorAll('#accuracy-stars .rating-star');
        accuracyStars.forEach(star => {
            star.classList.remove('active');
            star.setAttribute('aria-checked', 'false');
            star.setAttribute('tabindex', '-1');
        });
        accuracyStars[0].setAttribute('tabindex', '0');
        
        // é‡ç½®è©•åˆ†
        accuracyRating = 0;
        selfRating = 0;
        currentZodiacSymbol = "â™‹";
        userZodiacName = "";
        
        // å›åˆ°ç¬¬ä¸€æ­¥
        document.getElementById('step-statistics').classList.add('hidden');
        document.getElementById('step-reveal').classList.add('hidden');
        document.getElementById('step-birthday').classList.remove('hidden');
        
        currentStep = 1;
        updateProgressIndicator();
        
        AudioSystem.playSound('transition');
        speakToScreenReader('å¯¦é©—å·²é‡æ–°é–‹å§‹ï¼Œè«‹è¼¸å…¥ç”Ÿæ—¥é–‹å§‹æ–°çš„æ¸¬é©—');
    }

    console.log('ğŸŒŸ æ˜Ÿåº§äººæ ¼å¯¦é©—å·²åŠ è¼‰å®Œæˆ - åŒ…å«å®Œæ•´çš„ ARIA å¯è¨ªå•æ€§æ”¯æŒå’Œ OG åœ–ç‰‡ç”ŸæˆåŠŸèƒ½');
  </script>
</body>
</html>